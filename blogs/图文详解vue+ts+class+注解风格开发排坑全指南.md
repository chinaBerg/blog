tsçš„å¤§åŠ¿æ‰€è¶‹ï¼Œä½ è¿˜åœ¨å­å“§å­ä¸­å¾˜å¾Šåœ¨vue+jså¤§é—¨å£å—ï¼Ÿæ¥å§ï¼Œæ˜¯æ—¶å€™è¡¨æ¼”çœŸæ­£çš„æŠ€æœ¯äº†ï½ï½ï½

ä»vueå¼€å§‹ç«çƒ­èµ·æ¥åˆ°ç°åœ¨ï¼Œå·²ç»åŸºæœ¬ä¸Šå‰ç«¯å¼€å‘å°ä¼™ä¼´å…¥é—¨çš„æŠ€èƒ½äº†ã€‚ç›¸ä¿¡è¿™ä¹ˆä¹…æ—¶é—´è¿‡å»ä¹‹åï¼Œå¤§å®¶ä¹Ÿæ—©å·²ä¹ æƒ¯vueçš„å¼€å‘æ¨¡å¼äº†ã€‚é‚£ä¹ˆï¼Œä½ å’Œåˆ«äººæ¯”æ¯”çš„æ—¶å€™ï¼Œéš¾é“ä¸æƒ³æœ‰äº›è®¸äº®ç‚¹å—ï¼Ÿè™½ç„¶ç›®å‰vue2+å¯¹tsçš„æ”¯æŒæ²¡æœ‰åƒreactã€ngç­‰æ”¯æŒçš„æ›´å‹å¥½ï¼Œä½†æ˜¯éšç€ç¤¾åŒºç›¸å…³å·¥å…·é“¾çš„å®Œå–„ï¼Œå…¶ç”Ÿäº§é¡¹ç›®ä½¿ç”¨vue+tsä¹Ÿæ˜¯å®Œå…¨okçš„ã€‚

ç›¸ä¿¡å¾ˆå¤šå°ä¼™ä¼´ä¹Ÿæ—©å·²ç£¨åˆ€éœéœã€è·ƒè·ƒæ¬²è¯•äº†ã€‚é‚£ä¹ˆåœ¨vueå®é™…ç”Ÿäº§é¡¹ç›®è¯¥å¦‚ä½•è§„èŒƒã€ç³»ç»Ÿçš„ä½¿ç”¨vue+tsçš„å¼€å‘æ¨¡å¼å‘¢ï¼Ÿæœ¬æ–‡å°†ç³»ç»Ÿçš„è®²è¿°å¦‚ä½•åœ¨vue2+ä¸­å¼€å‘`typescript+class+æ³¨è§£`é£æ ¼çš„é¡¹ç›®ã€‚å›¾æ–‡è¯¦æƒ…ã€ç³»ç»Ÿä»‹ç»ã€ä¸“æ³¨äºæ’å‘ï¼Œä¸€èµ·åœ¨ç”Ÿäº§é¡¹ç›®ä¸­å¤§èƒ†ä½¿ç”¨vue+tså§ã€‚å¥¥åˆ©ç»™ï½ï½ï½

### âœ¨ å‡†å¤‡èµ·é£ fly~~~

- è¯´åˆ°èµ·æ­¥ï¼Œé¦–å…ˆè¯´ä¸‹åŸºæœ¬çš„å·¥å…·å’Œç¯å¢ƒå§ã€‚æˆ‘è¿™è¾¹ä½¿ç”¨çš„4+çš„cliè„šæ‰‹æ¶ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š

![ç¯å¢ƒæŸ¥çœ‹.jpg](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/6/16/172baca56e9925a0~tplv-t2oaga2asx-image.image)

- ä½¿ç”¨vue-cliåˆå§‹åŒ–é¡¹ç›®

```bash
# ç»ˆç«¯è¿è¡Œ
vue create vue-ts-demo
```

![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/6/16/172bacae51a84894~tplv-t2oaga2asx-image.image)

å¯ä»¥çœ‹åˆ°ï¼Œå‘½ä»¤è¿è¡Œåï¼Œè®©æˆ‘ä»¬é€‰æ‹©é¡¹ç›®ç›¸å…³çš„é…ç½®å‚æ•°ï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹©æ‰‹åŠ¨é€‰æ‹©ï¼ˆManually select feturesï¼‰

- å‹¾é€‰é…ç½®

![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/6/16/172bacb430775ddb~tplv-t2oaga2asx-image.image)

è¿™é‡Œå¦‚ä¸Šå›¾ï¼Œæœ€é‡è¦çš„æ˜¯å‹¾é€‰typescriptï¼Œé™¤äº†pwaä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜æ˜¯éƒ½é€‰æ‹©é…ç½®å§ã€‚å½“ç„¶äº†ä½ ä¹Ÿå¯ä»¥æ ¹æ®ä½ çš„éœ€æ±‚è€Œå®šï¼Œä½†æ˜¯tså¿…é¡»è¦å‹¾é€‰ï¼Œç¬”è®°æ˜¯tsçš„é¡¹ç›®å˜›ï½ï½ï½

- é€‰æ‹©classé£æ ¼çš„è¯­æ³•

![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/6/16/172bacca8742822d~tplv-t2oaga2asx-image.image)


è¿™é‡Œé€‰æ‹©classé£æ ¼ï¼Œå›è½¦å°±å¥½ã€‚å¦‚æœä½ ä¸å–œæ¬¢classé£æ ¼ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©å¦ï¼Œä½†æ˜¯æˆ‘ä»¬å»ºè®®tså¼€å‘æ—¶é€‰æ‹©classé£æ ¼ï¼Œä¼˜é›…ï¼ˆè£…é€¼â€¦ï¼‰ï¼Œå¦‚ä¸‹å›¾ï¼Œæœ€ç»ˆclassé£æ ¼çš„ä»£ç ä¼šæ˜¯è¿™æ ·ï¼š

![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/6/16/172baccf68f397c3~tplv-t2oaga2asx-image.image)
ä»…æ¼”ç¤ºéƒ¨åˆ†æˆªå›¾ï¼Œåç»­ä¼šè¯¦ç»†è®²è§£

- ç»§ç»­é€‰æ‹©é…ç½®ï¼Œç›´åˆ°å®Œæˆ

![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/6/16/172bacd76eb62cce~tplv-t2oaga2asx-image.image)

åé¢å°±æ˜¯ä¸€äº›åŸºæœ¬çš„é…ç½®é€‰æ‹©äº†ï¼Œåƒcssé¢„å¤„ç†å™¨ã€ä»£ç è§„èŒƒã€é…ç½®æ–‡ä»¶ä½ç½®ã€router modeç­‰ç­‰ï¼Œå¤§å®¶æ ¹æ®å›¢é˜Ÿè§„èŒƒæˆ–è€…ä¸ªäººçš„é£æ ¼è¿›è¡Œé€‰æ‹©å§ï¼Œè¿™ä¸ªæ²¡ä»€ä¹ˆè¦ç‰¹åˆ«è¯´æ˜äº†ã€‚æœ€åç­‰å¾…é¡¹ç›®åˆå§‹åŒ–å®Œæˆå³å¯ã€‚

- è¿è¡Œ

```bash
# è¿›å…¥é¡¹ç›®æ–‡ä»¶å¤¹
cd vue-ts-demo

# è¿è¡Œé¡¹ç›®
npm run serve
```

cli4+é¡¹ç›®åœ¨åˆå§‹åŒ–å®Œæˆä¹‹åï¼Œå…¶å®ä¾èµ–æ˜¯å·²ç»å®‰è£…å¥½äº†ï¼Œæ˜¯ä¸éœ€è¦å†`npm i`çš„äº†

é¡¹ç›®å¯åŠ¨åï¼Œåº”è¯¥å°±å¯ä»¥çœ‹åˆ°å¾ˆç†Ÿæ‚‰çš„é¡µé¢äº†

![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/6/16/172bacdcd90ff2dd~tplv-t2oaga2asx-image.image)


### âœ¨ åŸºç¡€ç›®å½•è®²è§£

- é¡¹ç›®åˆå§‹åŒ–çš„ç›®å½•

![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/6/16/172bace109483934~tplv-t2oaga2asx-image.image)

ä»å›¾ä¸Šå¯ä»¥çœ‹åˆ°ï¼ŒåŸºç¡€ç›®å½•åŸºæœ¬ä¸Šå’Œjsç‰ˆçš„vueé¡¹ç›®æ²¡å¤ªå¤§åŒºåˆ«ã€‚é¢å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯ä»¥çœ‹åˆ°æ ¹ç›®å½•æ–°å¢äº†`tsconfig.json`ä½œä¸ºtsçš„é…ç½®æ–‡ä»¶ï¼Œè¿˜æœ‰å…¶ä»–çš„é…ç½®éƒ½ç‹¬ç«‹æˆäº†é…ç½®æ–‡ä»¶çš„å½¢å¼ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘å‹¾é€‰çš„æ˜¯é…ç½®æ–‡ä»¶ç‹¬ç«‹å­˜åœ¨ã€‚ä½ åˆå§‹åŒ–é¡¹ç›®æ—¶ä¹Ÿå¯ä»¥é€‰æ‹©éƒ½æ”¾åœ¨browserListé…ç½®ä¸­ã€‚

å¦å¤–ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»¥å‰æ‰€æœ‰çš„`.js`æ–‡ä»¶éƒ½å˜æˆäº†`.ts`æ–‡ä»¶ã€‚

- åŸºæœ¬çš„vueç»„ä»¶æ¼”ç¤º

```
<template>
  <div class="hello">
  </div>
</template>

<script lang="ts">
import { Component, Prop, Vue } from 'vue-property-decorator';

@Component
export default class HelloWorld extends Vue {
  // å£°æ˜ä¸€ä¸ªprops
  @Prop() private msg!: string;
  
  // å£°æ˜ä¸€ä¸ªå˜é‡
  private count: number = 0
  
  // å£°æ˜ä¸€ä¸ªæ–¹æ³•
  private addCount() {
    this.count++
  }
}
</script>

<style scoped lang="less">
</style>
```

å¯ä»¥çœ‹åˆ°ï¼Œvueç»„ä»¶çš„ä¸‰å¤§ä»¶è¿˜æ˜¯é‚£ä¸‰å¤§ä»¶ï¼Œtemplateã€scriptã€styleã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯scriptæ ‡ç­¾éœ€è¦åŠ `lang="ts"`çš„æ ‡è¯†ï¼Œæ¥æŒ‡æ˜å½“å‰æ˜¯tsçš„è¯­æ³•ã€‚


å¦å¤–ï¼Œç»„ä»¶çš„åŸºæœ¬ä½¿ç”¨æ–¹å¼ï¼Œå˜æˆäº†æ³¨è§£+classé£æ ¼çš„ã€‚ä»`vue-property-decorator`ä¸­å¼•å…¥äº†æˆ‘ä»¬éœ€è¦çš„å†…å®¹ï¼Œæœ€åå¯¼å‡ºä¸€ä¸ªç»§æ‰¿åçš„ç±»ï¼Œè¿™ä¸ªç±»ä¹Ÿå¯ä»¥æ˜¯åŒ¿åçš„ï¼ˆå¦‚æœä½ æƒ³å·ä¸ªå°æ‡’çš„è¯ï¼‰ï¼š

```
@Component
export default class extends Vue {
    // ...
}
```

- classç»„ä»¶çš„è¯¦ç»†è¯´æ˜

```javascript
import {
  Component, Vue, Prop, Watch, Emit,
} from 'vue-property-decorator';

@Component
export default class Header extends Vue {
  // dataå†…çš„å±æ€§ç›´æ¥ä½œä¸ºå®ä¾‹å±æ€§ä¹¦å†™
  // é»˜è®¤éƒ½æ˜¯publicå…¬æœ‰å±æ€§
  nums = 0;
  // ä¹Ÿå¯ä»¥å®šä¹‰åªè¯»
  readonly msg2 = 'this is readonly data'
  // å®šä¹‰ç§æœ‰å±æ€§
  private msg3 = 'this is a private data'
  // å®šä¹‰ä¸€ä¸ªç§æœ‰ã€åªè¯»æ•°æ®
  private readonly msg4 = 'this is a private and readonly data'
  
  
  // @Propå®šä¹‰props
  // èŠ±æ‹¬å·å†…å®šä¹‰propçš„å‚æ•°ï¼Œä¾‹å¦‚defaultã€typeã€requiredç­‰
  @Prop({ default: 'this is title' }) title!: string;
  @Prop({ default: true }) fixed: boolean | undefined;

  // é€šè¿‡getterä¹¦å†™è®¡ç®—å±æ€§
  get wrapClass() {
    return ['head', {
      'is-fixed': this.fixed,
    }];
  }

  // è§‚å¯Ÿå±æ€§
  // å¯ä»¥é€šè¿‡ç¬¬äºŒä¸ªå‚æ•°ï¼Œè®¾ç½®immediateå’Œdeep
  @Watch('nums', { immediate: true, deep: true })
  handleNumsChange(n: number, o: number) {
    console.log(n, o);
  }

  // å®šä¹‰emitäº‹ä»¶ï¼Œå‚æ•°å­—ç¬¦ä¸²è¡¨ç¤ºåˆ†å‘çš„äº‹ä»¶å
  // å¦‚æœæ²¡æœ‰ï¼Œåˆ™ä½¿ç”¨æ–¹æ³•åä½œä¸ºåˆ†å‘äº‹ä»¶åï¼Œä¼šè‡ªåŠ¨è½¬è¿å­—ç¬¦å†™æ³•
  // æ³¨æ„ï¼Œè¿™æ ·å†™æ³•è²Œä¼¼æ— æ³•æ´¾å‘å¤šä¸ªå‚æ•°ï¼Œ
  // å¯ä»¥é€šè¿‡åŸæœ‰çš„this.$emitå†™æ³•æ´¾å‘
  @Emit('add')
  emitAdd(n: number) {
    return n;
  }
  @Emit('reduce')
  emitReduce() {
    return (this.nums, 123, 321);
  }

  // æ‰€æœ‰æ–¹æ³•åï¼Œç›´æ¥ä½œä¸ºç±»çš„æ–¹æ³•ä¹¦å†™
  private handleClickAdd() {
    this.nums += 1;
    this.emitAdd(this.nums);
  }
  private handleClickReduce() {
    this.nums -= 1;
    this.emitReduce();
  }
}
```

ä¸Šé¢ç»„ä»¶ï¼Œåœ¨æ³¨é‡Šé‡Œé¢è¯¦ç»†è¯´æ˜äº†tsç»„ä»¶çš„åŸºæœ¬å¸¸ç”¨è¯­æ³•ã€‚æœ‰äº†è¿™äº›è¯­æ³•ï¼ŒåŸºæœ¬é¡µé¢ä¹¦å†™å’Œæ•°æ®æ¸²æŸ“åº”è¯¥æ²¡é—®é¢˜äº†ã€‚å…³äºclassç»„ä»¶çš„ç”¨æ³•ï¼Œé¡¹ç›®å…¶å®æ˜¯ä½¿ç”¨äº†[vue-class-component](https://github.com/vuejs/vue-class-component#readme)å’Œ[vue-property-decorator](https://github.com/kaorun343/vue-property-decorator#readme)ä¸¤ä¸ªåº“ã€‚æ›´å¤šçš„åŸºæœ¬è¯­æ³•ï¼Œå°ä¼™ä¼´è¿˜æ˜¯éœ€è¦ç¿»é˜…æ–‡æ¡£çš„ã€‚

è¿™é‡Œè¦è¯´æ˜ä¸€ä¸‹è¿™ä¸¤ä¸ªåº“çš„å…³ç³»ã€‚`vue-class-component`æ˜¯å®˜æ–¹ç»´æŠ¤çš„ä¸€ä¸ªè®©vueæ”¯æŒclassçš„é£æ ¼çš„åº“ï¼Œè€Œ`vue-property-decorator`ä¹Ÿæ˜¯åŸºäº`vue-class-component`çš„ï¼Œä½†æ˜¯åœ¨å®ƒåŸºç¡€ä¹‹ä¸Šæ”¯æŒäº†æ³¨è§£çš„è¯­æ³•ï¼Œä»è€Œè®©æˆ‘ä»¬çš„ä»£ç è¯­æ³•æ›´åŠ çš„ç®€æ´å’Œæ˜“äºå¤ç”¨ã€‚ä»æˆ‘ä»¬çš„é¡¹ç›®ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œå…¶å®æœ€ç»ˆä½¿ç”¨çš„æ˜¯`vue-property-decorator`çš„è¯­æ³•çš„ã€‚

![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/6/16/172bacef65547fc8~tplv-t2oaga2asx-image.image)

- è¡¥å……ä¸€ä¸ªnpmæŸ¥é˜…æ–‡æ¡£çš„å‘½ä»¤

å¾ˆå¤šæ—¶å€™ï¼Œå¦‚æœæˆ‘ä»¬åƒå¿«é€Ÿçš„æ‰“å¼€ä¸€ä¸ªåº“çš„æ–‡æ¡£åœ°å€æˆ–è€…æºç åœ°å€æ—¶ï¼ˆåˆæ‡’å¾—å»æŸ¥ï¼‰ï¼Œå¯ä»¥é€šè¿‡npmçš„å‘½ä»¤å¿«é€Ÿåšåˆ°ï¼Œåªéœ€è¦ç»ˆç«¯è¿è¡Œï¼š

```bash
# æŸ¥é˜…æ–‡æ¡£
npm docs åº“åç§° 
# ä¾‹å¦‚æŸ¥è¯¢vue-class-componentçš„æ–‡æ¡£åœ°å€
npm docs vue-class-component

# æŸ¥çœ‹æºç åœ°å€
npm repo åº“åç§°
```

é‚£ä¹ˆè¿™æ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿ

![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/6/16/172bacf3b764eb7a~tplv-t2oaga2asx-image.image)

å…¶å®è¿™äº›å›¾åœ¨å¼€å‘æ—¶æ˜¯ä¼šåœ¨å…¶package.jsonæ–‡ä»¶ä¸­æŒ‡å®šçš„ç›¸å…³å‚æ•°çš„ã€‚å¯¹npmæ„Ÿå…´è¶£çš„å°ä¼™ä¼´ï¼Œå¯ä»¥ç»§ç»­ç¿»é˜…[npmæ–‡æ¡£](https://docs.npmjs.com/)ï¼Œå­¦ä¹ æ›´å¤šçš„npmçŸ¥è¯†ã€‚

### TSä¸‹è·¯ç”±æ’å‘æŒ‡å—

è¯´å®Œäº†vueå•æ–‡ä»¶çš„åŸºæœ¬ç”¨æ³•ä¹‹åï¼Œæˆ‘ä»¬è¦æ¥èŠèŠè·¯ç”±äº†ã€‚åœ¨tsæ¨¡å¼ä¸‹ï¼Œè·¯ç”±è¿˜æ˜¯æœ‰äº›ä¸œè¥¿éœ€è¦è¯´æ˜çš„ï¼Œä¸ç„¶ä½ åœ¨é¡¹ç›®é‡Œæœ‰äº›å‘ï¼Œä¼šè®©ä½ ä¸ˆäºŒå’Œå°šæ‘¸ä¸ç€å¤´è„‘çš„ï½ï½

- åŸºæœ¬çš„è·¯ç”±ä½¿ç”¨

![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/6/16/172bad015db19397~tplv-t2oaga2asx-image.image)

å¦‚å›¾æ‰€ç¤ºï¼ŒåŸºæœ¬çš„è·¯ç”±ä½¿ç”¨æ–¹å¼ï¼Œé¡¹ç›®åˆå§‹åŒ–çš„æ—¶å€™å·²ç»é…ç½®å¥½äº†ï¼Œåªä¸è¿‡åœ¨åŸæ¥çš„åŸºç¡€ä¹‹ä¸Šå¢åŠ äº†tsçš„ç±»å‹ã€‚

è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œbaseçš„è®¾ç½®æ˜¯`process.env.BASE_URL`ã€‚è¿™ä¸ªæ˜¯å“ªé‡Œæ¥çš„å‘¢ï¼Ÿå…¶å®è¯»å–çš„é…ç½®æ–‡ä»¶ä¸­çš„ä¿¡æ¯ã€‚cli4+åˆå§‹åŒ–çš„é¡¹ç›®æ˜¯æ”¯æŒé…ç½®æ–‡ä»¶çš„ã€‚å¯ä»¥åœ¨æ ¹ç›®å½•ä¸‹æ ¹æ®ç¯å¢ƒä¸åŒæ–°å»ºå‡ ä¸ªé…ç½®æ–‡ä»¶ï¼š

![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/6/16/172bad0b1d987212~tplv-t2oaga2asx-image.image)

æ³¨æ„æ˜¯`.env`å¼€å¤´ï¼Œåé¢æ˜¯ç¯å¢ƒç±»å‹ï¼Œä¾‹å¦‚è¿™é‡Œç®€å•æ¼”ç¤ºäº†æœ¬åœ°å¼€å‘ç¯å¢ƒï¼Œçº¿ä¸Šdevç¯å¢ƒå’Œçº¿ä¸Šç”Ÿäº§ç¯å¢ƒçš„é…ç½®æ–‡ä»¶ã€‚åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®ä¸åŒç¯å¢ƒè¿›è¡Œä¸åŒçš„é…ç½®ï¼Œä¾‹å¦‚ï¼š

![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/6/16/172bad1030dc4f99~tplv-t2oaga2asx-image.image)

ä¾‹å¦‚ä¸Šé¢çš„è·¯ç”±baseçš„é…ç½®ï¼Œä¹Ÿå¤§å¤šæ—¶å€™ä¼šåœ¨è¿™é‡Œé…ç½®ä¸åŒçš„ç¯å¢ƒçš„apiåœ°å€ã€‚å¯èƒ½å°ä¼™ä¼´è¿™é‡Œä¼šæœ‰ä¸ªå°ç–‘é—®ï¼Œä¸ºä»€ä¹ˆé…ç½®äº†localç¯å¢ƒè¿˜é…ç½®äº†ä¸€ä¸ªdevç¯å¢ƒï¼Œå¦‚æœä½ æœ¬åœ°å¼€å‘å‡ºç°è·¨åŸŸï¼Œè€Œåç«¯éœ€è¦ä½ æ¥å¤„ç†çš„æ—¶å€™ï¼Œä½ è·¨åŸŸåœ¨è¿™é‡Œå•ç‹¬é…ç½®ä¸€ä¸ªæœ¬åœ°ç¯å¢ƒå¤„ç†apiï¼Œç„¶ååšä¸€äº›ä»£ç†çš„äº‹æƒ…ï¼Œç„¶åçº¿ä¸Šdevçš„æ—¶å€™ä¸å»å¤„ç†è·¨åŸŸçš„é—®é¢˜ã€‚è¿˜æ˜¯æ ¹æ®ä½ çš„éœ€æ±‚ã€‚

è¿™é‡Œå†è¡¥å……ä¸€ä¸‹ï¼Œå¦‚æœå‰ç«¯å¤„ç†è·¨åŸŸè¯¥æ€ä¹ˆå¤„ç†å§ã€‚åœ¨æ ¹ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª`vue.config.js`æ–‡ä»¶ï¼Œè¿™æ˜¯cli4ä¸­è‡ªå®šä¹‰webpackè„šæœ¬é…ç½®çš„æ–¹æ³•ï¼Œå¯ä»¥ç¿»é˜…[cliæ–‡æ¡£](https://cli.vuejs.org/zh/guide/webpack.html)ï¼Œæœ‰è¯¦ç»†çš„è¯´æ˜ã€‚è¿™é‡Œçœ‹ä¸‹å…·ä½“æ€ä¹ˆé…ç½®ï¼š

```javascript
// ä»¥æˆ‘ä¸Šé¢ä¸ºä¾‹
module.exports = {
    devServer: {
    proxy: {
      '/hermes/api/v1/': {
        // éœ€è¦ä»£ç†åˆ°çš„åŸŸååœ°å€
        // å³ï¼Œå½“é‡åˆ°'/hermes/api/v1/'æ—¶ï¼Œå°†è¯·æ±‚ä»£ç†åˆ°'http:xxxx.com'
        target: 'http:xxxx.com',
        changeOrigin: true
      },
      '/bms/api/v1/': {
        target: ''http:xxxx.com',
        changeOrigin: true
      }
    }
  },
}
```

è§£é‡Šä¸€ä¸‹ï¼Œä¸Šé¢é€šè¿‡è®¾ç½®proxyï¼Œæ¥è®¾ç½®å½“é‡åˆ°'/hermes/api/v1/'çš„è¯·æ±‚åœ°å€æ—¶ï¼Œåˆ™å°†è¯·æ±‚ä»£ç†åˆ°å…¶'http:xxxx.com'åŸŸåï¼Œåé¢åŒç†ã€‚

é‚£è¿™æ—¶å€™ï¼Œéœ€è¦ç»™å¤§å®¶çœ‹ä¸€ä¸‹apiæ€ä¹ˆå†™äº†ï¼š

```
// ç®€å•æ¼”ç¤ºä¸€ä¸‹ï¼Œå› ä¸ºapiæ˜¯çš„å•ç‹¬ç®¡ç†å¤„ç†çš„
// éƒ½åœ¨src/api/æ–‡ä»¶å¤¹ä¸‹
// ä¾‹å¦‚è¿™æ˜¯ä¸€ä¸ªaccount.tsæ¨¡å—

// å¼•å…¥æˆ‘ä»¬çš„ç¯å¢ƒå˜é‡ä¸­çš„åŸŸåå‰ç¼€
// æœ¬åœ°å¼€å‘ä¸­ï¼Œè‚¯å®šå°±æ˜¯æˆ‘ä»¬ä¸Šé¢è®¾ç½®çš„åŸŸåå‰ç¼€
// è¿™æ ·çš„è¯ï¼Œä¾¿ä¼šè¿›è¡Œä»£ç†æœåŠ¡äº†ï¼Œä»è€Œå¤„ç†è·¨åŸŸé—®é¢˜
const { VUE_APP_API_KB } = process.env;

export interface ILogin {
  account: string;
  password: string;
}

// ç™»å½•
export const login = (data: ILogin): Promise<object> => {
  data.password = md5(data.password);
  return request({
    url: `${VUE_APP_API_KB}login`,
    method: 'post',
    data,
  });
};

```

- è·¯ç”±é’©å­çš„æ³¨å†Œ

æƒ³ä½¿ç”¨è·¯ç”±é’©å­ï¼Œå¾ˆé‡è¦çš„ä¸€ç‚¹ï¼Œæ˜¯è¦å…ˆæ³¨å†Œï¼Œä¸ç„¶æ˜¯æ— æ³•ä½¿ç”¨çš„ã€‚é‚£ä¹ˆå¦‚ä½•æ³¨å†Œå‘¢ï¼Ÿæˆ‘ä»¬åœ¨routeræ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸€ä¸ª`ä¸ªclass-component-hooks.ts`æ–‡ä»¶ï¼š

```javascript
import Component from 'vue-class-component';
// or
// import { Component } from 'vue-property-decorator';

// Register the router hooks with their names
Component.registerHooks([
  'beforeRouteEnter',
  'beforeRouteLeave',
  'beforeRouteUpdate',
]);
```

ç„¶ååœ¨`mian.ts`æ–‡ä»¶ä¸­ï¼Œ**æœ€é¡¶éƒ¨è¿›è¡Œå¼•å…¥**ï¼Œä¿è¯åœ¨æ‰€æœ‰ç»„ä»¶å¼•å…¥ä¹‹å‰æ‰§è¡Œã€‚è¿™ç‚¹å¾ˆé‡è¦ï¼ï¼ï¼

```
// main.tsé¡¶éƒ¨å¯¼å…¥
import './router/class-component-hooks';
```

- å±€éƒ¨è·¯ç”±å®ˆå«å‚æ•°ç±»å‹

è¯é¢˜è¿˜æ˜¯å›åˆ°æˆ‘ä»¬çš„è·¯ç”±ä¸Šé¢ã€‚å…³äºè·¯ç”±ï¼Œæœ‰ä¸€ç‚¹éœ€è¦é¢å¤–æ³¨æ„çš„å°±æ˜¯è·¯ç”±å®ˆå«çš„ä½¿ç”¨ï¼Œè¿™ç‚¹æ˜¯è¦æ³¨æ„çš„ï¼Œä¸ç„¶æŠ¥é”™ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬çœ‹ä¸‹é¡µé¢å†…çš„è·¯ç”±å®ˆå«çš„å‚æ•°é—®é¢˜ï¼š

```javascript
// å¼•å…¥æ³¨è§£æ’ä»¶æš´éœ²å‡ºçš„ç›¸å…³å†…å®¹
import { Vue, Component } from 'vue-property-decorator';
// å¼•å…¥è·¯ç”±ä¸­çš„Routeå¯¹è±¡
import { Route } from 'vue-router';


@Component({})
export default class App extends Vue {
    // å‚æ•°ç±»å‹çš„å®šä¹‰ï¼Œä½¿ç”¨Routeï¼Œ
    // nextæ˜¯å‡½æ•°ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ä½¿ç”¨Functionå¯¹è±¡,
    // æˆ–è€…æ˜¯next: () => void
    beforeRouteEnter(to: Route, from: Route, next: Function) {
        next();
    }
}
```

å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨ç±»ä¼¼`beforeRouteEnter`ç­‰è·¯ç”±é’©å­æ—¶ï¼Œéœ€è¦å®šä¹‰å‚æ•°çš„ç±»å‹ï¼Œè¿™é‡Œæˆ‘ä»¬ä»`vue-router`ä¸­å¼•å…¥äº†`Route`ç±»å‹ä½œä¸º`from`å’Œ`to`çš„å‚æ•°ç±»å‹ã€‚å› ä¸ºtså‡½æ•°å‚æ•°æ˜¯éœ€è¦å®šä¹‰ç±»å‹çš„ã€‚è€Œnextå‚æ•°ï¼Œå¦‚æœæ±‚ç®€å•çš„è¯ï¼Œå¯ä»¥ç›´æ¥å†™ä¸ª`Function`ç±»å‹ã€‚


### âœ¨ TSä¸‹å¦‚ä½•æŠ‰æ‹©VuexåŠå…¶å‘ç‚¹

è¯´åˆ°vuexï¼Œå¯æ˜¯vueé¡¹ç›®çš„é‡ç‚¹ä¹‹ä¸€äº†ã€‚ç›¸ä¿¡å¤§å®¶å¯¹äºjsç‰ˆæœ¬çš„é¡¹ç›®å¦‚ä½•ä½¿ç”¨vuexå·²ç»æ˜¯å¦‚é±¼å¾—æ°´äº†ã€‚è¿™é‡Œä»‹ç»ä¸€ä¸‹tsç‰ˆæœ¬ä¸­å¦‚ä½•ä½¿ç”¨vuexã€‚

åœ¨è¿™é‡Œï¼Œæˆ‘ä»‹ç»çš„æ˜¯[vuex-module-decorators](https://github.com/championswimmer/vuex-module-decorators#readme)ï¼ŒåŒ…æ‹¬æˆ‘çš„é¡¹ç›®ä¸­ä¹Ÿæ˜¯ä½¿ç”¨çš„è¯¥åº“ã€‚é™¤æ­¤ä¹‹å¤–ä¹Ÿæœ‰ä¸€ä¸ª[vuex-class](https://github.com/ktsn/vuex-class),è¿™ä¸¤ä¸ªéƒ½æ˜¯å¯ä»¥åœ¨tsä¸­è¾…åŠ©æˆ‘ä»¬æ›´å¥½çš„ä½¿ç”¨vuexçš„ã€‚ä½†æ˜¯æˆ‘ä¸ºä»€ä¹ˆé€‰æ‹©å’Œæ¨è`vuex-module-decorators`,åé¢æˆ‘ä¼šè¿›è¡Œè¯´æ˜ã€‚å¥½äº†ï¼Œä¸‹é¢å…ˆçœ‹ä¸‹è¿™ä¸ªåº“è¯¥å¦‚ä½•ä½¿ç”¨å§ï¼š

- å®‰è£…vuex-module-decorators

```bash
# å®‰è£…vuex-module-decorators
# æ”¯æŒæ³¨è§£çš„æ–¹å¼å¼€å‘storeä¸­çš„å†…å®¹
cnpm i vuex-module-decorators -S
```

æˆ‘å…ˆçœ‹ä¸‹æˆ‘ä»¬ä¹‹å‰é»˜è®¤çš„storeæ˜¯ä»€ä¹ˆå†…å®¹ï¼š

![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/6/16/172bad185bba2629~tplv-t2oaga2asx-image.image)

å¯ä»¥çœ‹åˆ°åŸºæœ¬ä¸Šå’Œæ­£å¸¸æˆ‘ä»¬çš„é¡¹ç›®åˆå§‹åŒ–çš„storeç»“æ„å¹¶æ— äºŒå¼‚ï¼Œæ— éæ˜¯index.jså˜æˆäº†index.tsã€‚

ä¸‹é¢æˆ‘ä»¬å…ˆåŸºæœ¬çš„ç»„ç»‡ä¸€ä¸‹æ–‡ä»¶ç»“æ„ï¼Œé¡¹ç›®ä¸­åŸºæœ¬ä¸Šä¸€å®šæ˜¯ä¼šæŒ‰æ¨¡å—åˆ’åˆ†çš„ï¼Œé™¤éé¡¹ç›®çœŸçš„å¾ˆå°ã€‚å¦‚ä¸‹å›¾ï¼Œåº”è¯¥æ˜¯æˆ‘ä»¬æ¯”è¾ƒç†Ÿæ‚‰çš„ä»£ç ç»„ç»‡ç»“æ„ï¼š

![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/6/16/172bad2091cd169b~tplv-t2oaga2asx-image.image)

æ­£å¸¸æ¥è¯´ï¼Œæˆ‘ä»¬ä¼šåœ¨`modules`æ–‡ä»¶å¤¹ä¸­åˆ’åˆ†åŠŸèƒ½æ¨¡å—ï¼Œ`index.ts`ä½œä¸ºå‡ºå£ï¼Œ`constant.ts`ä½œä¸ºå¸¸é‡æ–‡ä»¶ï¼›`mutation-types.ts`ä½œä¸º`mutations`çš„ç±»å‹ç®¡ç†æ–‡ä»¶ã€‚è¿™é‡Œæš‚æ—¶å…ˆä¸è¯´store.tsï¼Œå› ä¸ºè¿™æ˜¯æˆ‘ä»¬ç­‰ä¸‹æ”¹é€ åçš„æ–‡ä»¶ç»“æ„ï¼›

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æŒ¨ä¸ªä»”ç»†è¯´è¯´æ¯ä¸ªæ–‡ä»¶è¯¥å¦‚ä½•ä¹¦å†™å’Œç»„ç»‡ã€‚

- store/index.tsï¼Œsotreæ–‡ä»¶çš„ç»Ÿä¸€æš´éœ²å‡ºå£

```
// store/index.ts

export { default as AccountModule } from './modules/account';
export { default as DownloadModule } from './modules/download';
export { default as DownlableModule } from './modules/kbAnalyse';

// ....
```

å¦‚ä¸Šæ‰€ç¤ºï¼Œæ˜¯æˆ‘ä»¬çš„index.tsæ–‡ä»¶ï¼Œæˆ‘ä»¬åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­åšäº†ä»€ä¹ˆäº‹æƒ…å‘¢ï¼Ÿå…¶å®å°±æ˜¯æŠŠæˆ‘ä»¬çš„moudlesæ–‡ä»¶å¤¹ä¸‹çš„æ¨¡å—å¯¼å…¥è¿›æ¥ï¼Œç„¶åå†ç»Ÿä¸€æš´éœ²å‡ºå»ã€‚å¦‚æœä¸æ¸…æ¥šè¯­æ³•ä¸ºä½•è¿™æ ·å†™çš„ï¼Œå¯ä»¥[ç‚¹å‡»è¿™é‡Œäº†è§£ä¸€ä¸‹ES6å¯¼å…¥å¯¼å‡ºçš„å¤åˆå†™æ³•](https://es6.ruanyifeng.com/#docs/module#export-%E4%B8%8E-import-%E7%9A%84%E5%A4%8D%E5%90%88%E5%86%99%E6%B3%95)ã€‚

é‚£æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšå‘¢ï¼Ÿä¸ºä»€ä¹ˆè¦ç»Ÿä¸€å¯¼å…¥å¯¼å‡ºå‘¢ï¼Ÿå®åˆ™æ˜¯ä¸ºäº†ä½¿ç”¨æ–¹ä¾¿ï¼Œä¸‹é¢æˆ‘ä»¬çœ‹ä¸‹æ˜¯å¦‚ä½•åœ¨é¡µé¢ä¸­ä½¿ç”¨storeä¸­çš„æ•°æ®å’Œæ–¹æ³•çš„ã€‚

- ç»„ä»¶ä¸­å¦‚ä½•ä½¿ç”¨storeæ•°æ®

æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨æ­£å¸¸æ¨¡å¼ä¸‹çš„vueç»„ä»¶ä½¿ç”¨storeé€šå¸¸æ˜¯å¦‚ä¸‹è¿™æ ·çš„ï¼š

```
// ç»„ä»¶ä¸­
import { mapState, mapGetters, mapActions } from 'vuex'

export default {
    computed: {
        ...mapGetters('analyse', [
            'someGetterName'
        ])
    },
    methods: {
        ...mapActions('analyse', [
            'customResetState'
        ]),
    }
}
```

ä¸‹é¢æˆ‘ä»¬çœ‹ä¸‹åœ¨å¼•å…¥äº†`vuex-module-decorators`ä¹‹åæ˜¯å¦‚ä½•ä½¿ç”¨vuexä¸­æ•°æ®å’Œæ–¹æ³•çš„ï¼š

```
// classé£æ ¼çš„ç»„ä»¶ä¸­
import { Component, Vue, Ref } from 'vue-property-decorator';
// é¦–å…ˆå¼•å…¥æˆ‘ä»¬çš„storeä¸­çš„æ¨¡å—
import { AccountModule } from '@/store/index';

@Component({
  name: 'Login',
})
export default class extends Vue {
    // çœç•¥å…¶ä»–ä»£ç 

    /**
     * å‘é€ç™»å½•çš„requestè¯·æ±‚
     */
    private async submitLogin() {
        if (this.isLoading) return;
        try {
          this.isLoading = true;
          const params = clone(this.formData);
          
          // è¿™é‡Œç›´æ¥é€šè¿‡è¯¥æ¨¡å—è°ƒç”¨storeä¸­çš„loginè¿™ä¸ªaction
          await AccountModule.login(params);
          const { redirect } = this.$route.query;
          this.$router.replace(redirect ? decodeURIComponent(redirect) : '/');
        } catch (error) {
          this.$Notice.error({ title: error });
        } finally {
          this.isLoading = false;
        }
    }
    
    // çœç•¥å…¶ä»–ä»£ç 
}
```

ä¸Šè¿°æ¼”ç¤ºäº†ä¸€ä¸ªactionçš„åŸºæœ¬è°ƒç”¨ï¼Œå…¶ä»–stateã€getterç­‰éƒ½ä¸€æ ·ï¼Œç›´æ¥è°ƒç”¨æ¨¡å—é‡Œé¢å¯¹åº”çš„å†…å®¹å³å¯ã€‚å¦‚æ­¤ï¼Œè¿˜ç®—æ˜¯è›®æ–¹ä¾¿çš„ã€‚æ›´æœ‰tsçš„ç±»å‹æ¨å¯¼çš„åŠ æŒï¼Œéå¸¸æ–¹ä¾¿ã€‚

- å¦‚ä½•å®šä¹‰ä¸€ä¸ªstoreæ¨¡å—

ä¸Šé¢ä»‹ç»äº†store/index.tsä»¥åŠç»„ä»¶ä¸­å¦‚ä½•ä½¿ç”¨ï¼Œç°åœ¨æˆ‘ä»¬çœ‹ä¸‹å¦‚ä½•å®šä¹‰æ¨¡å—ã€‚è¯´åˆ°å¼€å‘æ¨¡å—ï¼Œå…¶å®æˆ‘ä»¬çœ‹åˆ°ï¼Œæˆ‘ä»¬åªæ˜¯åœ¨index.tsä¸­å¯¹æ¨¡å—è¿›è¡Œäº†å¯¼å…¥å¯¼å‡ºï¼Œå…¶å®æˆ‘ä»¬è¿˜æ˜¯æ²¡æœ‰å®ä¾‹åŒ–æˆ‘ä»¬çš„storeå®ä¾‹çš„ã€‚å› ä¸ºæœ¬æ¥æ˜¯åœ¨indexä¸­å®ä¾‹åŒ–çš„ï¼Œæˆ‘ä»¬æŠŠindex.tsç”¨æ¥å¯¼å…¥å¯¼å‡ºäº†ï¼Œæ‰€ä»¥å®ä¾‹åŒ–çš„éƒ¨åˆ†æ²¡äº†ã€‚

é‚£ä¹ˆå…ˆè¯´è¯´ä¸ºä»€ä¹ˆè¦åœ¨index.tsä¸­è¿›è¡Œå¯¼å…¥å¯¼å‡ºï¼Œå…¶å®æ˜¯ä¸ºäº†åœ¨ç»„ä»¶äººå¼•å…¥æ—¶storeæ¨¡å—æ—¶æ–¹ä¾¿ï¼Œæ ¹æ®node.jsçš„æ–‡ä»¶æŸ¥æ‰¾è§„åˆ™ï¼Œæˆ‘ä»¬åªéœ€è¦å†™åˆ°'@/store'å³å¯ã€‚è¯´å®Œäº†è¿™ä¸ªï¼Œè¯¥æ¥çœ‹æˆ‘ä»¬store/store.tsäº†ï¼š

```
// store/store.ts

import Vue from 'vue';
import Vuex from 'vuex';

Vue.use(Vuex);

export default new Vuex.Store({});
```

å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„store.tsï¼Œå…¶å®æ˜¯è¢«æˆ‘ä»¬ç”¨æ¥å®ä¾‹åŒ–storeäº†ã€‚æ³¨æ„ï¼Œè¿™é‡Œæˆ‘ä»¬æ²¡æœ‰ç®€åŒ–æ¼”ç¤ºï¼Œç¡®ç¡®å®å®æˆ‘ä»¬å®ä¾‹åŒ–storeæ—¶ä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œå› ä¸ºæˆ‘ä»¬æƒ³åšçš„æ˜¯åŠ¨æ€æ³¨å†Œstoreæ¨¡å—ï¼Œstoreæ˜¯æ”¯æŒè¿™ä¸ªåŠŸèƒ½çš„ã€‚ä¸‹é¢æˆ‘ä»¬çœ‹ä¸‹å¦‚ä½•åŠ¨æ€æ³¨å†Œstoreæ¨¡å—ã€‚

- åŠ¨æ€æ³¨å†Œstoreæ¨¡å—

æˆ‘ä»¬æ¥çœ‹ä¸‹æˆ‘ä»¬ä¹¦å†™storeæ¨¡å—çš„åŸºæœ¬çš„ä¸€ä¸ªæ ¼å¼ï¼š

```
import store from '@/store/store';
import {
  VuexModule, Module, Mutation, Action, getModule,
} from 'vuex-module-decorators';

@Module({
  dynamic: true, namespaced: true, name: 'account', store,
})
class Account extends VuexModule {
  // stateæ¼”ç¤ºï¼Œç”¨æˆ·token
  public token = getToken() || ''
  
  // getteræ¼”ç¤ºï¼Œå¹³å°codeæ•°ç»„
  public get platformGetter(): string[] {
    return this.userConfig.platform;
  }

  // mutationæ¼”ç¤º
  @Mutation
  private [types.SET_TOKEN](token: string) {
    this.token = token;
    setToken(token);
  }
  
  // actionæ¼”ç¤º
  // ç”¨æˆ·ç™»å½•
  @Action({ commit: types.SET_TOKEN, rawError: true })
  public async login(params: accountApi.ILogin) {
    const data = await accountApi.login(params);
    return data;
  }
}
```

é€šè¿‡å¦‚ä¸Šæ¼”ç¤ºï¼Œæˆ‘ä»¬è¦æ³¨æ„å‡ ä¸ªå°ç‚¹ï¼š

ä¸€ã€æˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªç»§æ‰¿VuexModuleçš„ç±»æ¥ä½œä¸ºå¯¼å‡ºçš„module

äºŒã€æˆ‘ä»¬é€šè¿‡å®ä¾‹å±æ€§æ¥å±æ€§stateå¯¹è±¡ï¼Œé€šè¿‡ç±»çš„getå±æ€§æ¥å±æ€§vexçš„getterå±æ€§ï¼Œé€šè¿‡@Mutationã€@Actionæ¥å¼€å‘å¯¹äºçš„mutationå’Œaction

ä¸‰ã€æˆ‘ä»¬åœ¨`@Module({})`ä¸­åŠ¨æ€æ³¨å†Œæ¨¡å—ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨ä¼ å…¥`store`å’Œé€šè¿‡`dynamic: true`æŒ‡å®šæ˜¯åŠ¨æ€çš„ï¼›é€šè¿‡`namespaced`å¼€å¯å‘½åç©ºé—´ï¼Œ`name`æ¥æŒ‡å®šæ¨¡å—åç§°ï¼›

å››ã€æ³¨æ„ä¸€ä¸‹mutationçš„åç§°å†™æ³•ï¼Œå’Œvueä¸­å…¶å®æ˜¯ä¸€æ ·çš„ï¼Œä¸è¿‡å¯èƒ½è¿˜æœ‰ä¸€äº›å°ä¼™ä¼´ä¸çŸ¥é“`[types.SET_TOKEN]() {}`åˆ°åº•æ˜¯ä»€ä¹ˆæ„æ€ï¼Œè¿™å…¶å®æ˜¯es6çš„å±æ€§åè¡¨è¾¾å¼ï¼Œå°±æ˜¯æŠŠè¡¨è¾¾å¼ä½œä¸ºå±æ€§çš„keyï¼Œä¸æ¸…æ¥šçš„å°ä¼™ä¼´å¯ä»¥ç‚¹å‡»[å±æ€§åè¡¨è¾¾å¼](https://es6.ruanyifeng.com/#docs/object#%E5%B1%9E%E6%80%A7%E7%9A%84%E7%AE%80%E6%B4%81%E8%A1%A8%E7%A4%BA%E6%B3%95)è¡¥è¡¥è¯¾ã€‚

äº”ã€actionè¿™é‡Œï¼Œæœ‰2ç‚¹éœ€è¦æ³¨æ„ä¸€ä¸‹ã€‚é¦–å…ˆæ˜¯ï¼Œå¦‚æœåœ¨actionå‚æ•°ä¸­æŒ‡å®šæ¥commitæ˜¯è°ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨actionæ–¹æ³•å†…ç›´æ¥returnæ•°æ®ï¼Œè¿™æ ·å…¶å®ä¹Ÿæ˜¯ä¼šè°ƒç”¨ä¸Šé¢çš„commitæ–¹æ³•çš„

```
@Action({ commit: types.SET_TOKEN})
public async login() {
    const data = await accountApi.login();
    return data;
}

// ç­‰åŒäº
@Action()
public async login() {
    const data = await accountApi.login();
    // æ³¨æ„ï¼Œä¸€å®šæ˜¯contextå¯¹è±¡ä¸Šè°ƒç”¨commitæ–¹æ³•
    this.context.commit(types.SET_TOKEN, data)
}
```

æ­£å¸¸è°ƒç”¨commitéƒ½æ˜¯é€šè¿‡this.contextæ¥ä¼ é€’çš„ï¼Œåªä¸è¿‡å¦‚æœåªè¦ä¸€ä¸ªå°±å¯ä»¥ç®€å†™è€Œå·²ï¼›å¦‚æœæ˜¯éœ€è¦å¤šä¸ªcommitï¼Œé‚£åªèƒ½æ˜¯è€è€å®å®commitäº†ã€‚

å…³äºactionï¼Œè¿˜æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯é”™è¯¯çš„æ•è·ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```
@Action({ commit: types.SET_TOKEN, rawError: true })
```

[rawErrorçš„issue](https://github.com/championswimmer/vuex-module-decorators/issues/26)

[rawErrorå…¨å±€å¼€å¯é…ç½®ï¼Œåœ¨æ–‡æ¡£æœ€å](https://github.com/championswimmer/vuex-module-decorators#readme)

è¿™é‡Œå¦‚æœä¸é…ç½®rawError: trueä¼šä½¿å¾—ä½ çš„ä¸»åŠ¨æŠ›é”™ä¼šæœ‰é—®é¢˜ã€‚è¿™ä¸ªä¸€å®šè¦æ³¨æ„ã€‚

å…­ã€æœ€åä¸€ç‚¹ï¼Œè‡³äºåˆ™ä¹ˆå–å¾—å…¶ä»–æ¨¡å—çš„stateã€getterã€actionç­‰ï¼Œç›´æ¥æ‰“å°ä¸€äº›ç›¸å…³çš„å‚æ•°å’Œè½½ä½“å¯¹è±¡å°±çŸ¥é“äº†ï¼Œæš‚ä¸å¤šè¯´äº†ã€‚


- mutation-typesé›†ä¸­ç®¡ç†æ‰€æœ‰çš„muation

è¿™ä¸€å—æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œå’Œå¹³å¸¸é¡¹ç›®ä¸€æ ·ï¼ŒæŠŠæ‰€æœ‰çš„mutationåç§°é›†ä¸­ç®¡ç†èµ·æ¥ã€‚ä½†æ˜¯å¦‚æœåç§°è¶Šæ¥è¶Šå¤šï¼Œå…¶å®ä¹Ÿæ˜¯ä¸å¥½ç®¡ç†çš„ï¼Œå‘½åå®¹æ˜“å†²çªï¼Œå¦‚æœçœŸçš„å¾ˆå¤šï¼Œå»ºè®®è¿˜æ˜¯åˆ†æ¨¡å—å§ã€‚

```
export const SET_TOKEN = 'SET_TOKEN';
export const RESET_TOKEN = 'RESET_TOKEN';
export const SET_USER_INFO = 'SET_USER_INFO';
export const SET_USER_CONFIG = 'SET_USER_CONFIG';
export const LOGOUT = 'LOGOUT';
```

- storeæ¨¡å—ä¸­tsçš„ä¸€äº›è¯´æ˜

æˆ‘ä»¬ä¼šåœ¨storeä¸­å®šä¹‰stateï¼Œåœ¨å¼•å…¥äº†tsä¹‹åï¼Œæˆ‘ä»¬å…¶å®æ›´å¥½çš„å¯ä»¥è¦æ±‚æˆ‘ä»¬çš„moduleçš„ç±»å®ç°æˆ‘ä»¬çš„å®šä¹‰çš„å¥½çš„ç±»å‹ï¼š

```
// store/module/account.ts
// çœç•¥å…¶ä»–...

interface IState {
  token: string | undefined;
  userInfo: IUserInfo;
  userConfig: IConfig;
}

@Module({
  dynamic: true, namespaced: true, name: 'account', store,
})
class Account extends VuexModule implements IState {
  // ç”¨æˆ·token
  public token = getToken() || ''

  // ç”¨æˆ·ä¿¡æ¯
  public userInfo: IUserInfo = getDefaultUserInfo()

  // å®¢æˆ·é…ç½®
  public userConfig: IConfig = getUserConfig()
}

// ...çœç•¥å…¶ä»–
```

å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬è¦æ±‚æˆ‘ä»¬çš„Accountåœ¨ç»§æ‰¿VuexModuleåï¼Œå¿…é¡»å®ç°æˆ‘ä»¬å®šä¹‰çš„IStateè¿™ä¸ªç±»å‹ï¼Œå³æˆ‘ä»¬çš„ç±»å¿…é¡»è¦æœ‰
IStateä¸­æ‰€å«æœ‰çš„ç±»å‹ï¼Œå¦åˆ™tså°±ä¼šç»™æˆ‘æŠ¥é”™ã€‚åŒæ—¶ï¼Œè¿™äº›å®ä¾‹çš„ç±»å‹ä¹Ÿå¿…é¡»å¾—æ˜¯æˆ‘ä»¬ä¹‹å‰å®šä¹‰å¥½çš„ç±»å‹ã€‚è¿™æ ·å°±ä¼šä½¿å¾—ä»£ç æ›´ä¸¥è°¨å’Œæ›´åˆ©äºå¤šäººåˆä½œï¼Œè¿™ä¹Ÿæ­£ä½“ç°äº†tsä¼˜åŠ¿æ‰€åœ¨ã€‚


### âœ¨ vuex-module-decoratorsä¸vuex-classå¯¹æ¯”PK

å‰é¢ä¹Ÿæåˆ°äº†è¯´è¦å¯¹æ¯”ä¸€ä¸‹ä¸¤ä¸ªåº“ï¼Œä¸ºä»€ä¹ˆé€‰æ‹©vuex-module-decoratorsã€‚

- é¦–å…ˆç”¨æ³•ä¸Šæ¥è¯´ï¼Œä¸¤è€…æ˜¯å„ç§åƒç§‹çš„ã€‚

vuex-module-decoratorsæ˜¯åœ¨å®šä¹‰æ¨¡å—æ—¶é€šè¿‡æ³¨è§£ï¼ˆè£…é¥°å™¨ï¼‰çš„è¯­æ³•æ¥åšçš„ï¼Œåœ¨ä½¿ç”¨çš„æ—¶å€™é€šè¿‡ç›´æ¥å¼•å…¥å¯¹åº”çš„moduleè®©ï¼Œç„¶åç›´æ¥ä½¿ç”¨moduleä¸Šçš„å±æ€§æˆ–æ–¹æ³•ã€‚

vuex-classæ˜¯åœ¨å®šä¹‰æ¨¡å—æ—¶ï¼Œå’Œæ™®é€šé¡¹ç›®åŸºæœ¬ä¸€æ ·ï¼Œåªä¸è¿‡æ˜¯éœ€è¦å¯¹å˜é‡å¢åŠ ç±»å‹è€Œå·²ã€‚ä½†æ˜¯ä½¿ç”¨çš„æ—¶å€™æ˜¯é€šè¿‡æ³¨è§£ï¼ˆè£…é¥°å™¨çš„è¯­æ³•ï¼‰ï¼Œå¦‚ä¸‹å›¾ï¼š

![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/6/16/172bad3139b98c3d~tplv-t2oaga2asx-image.image)

å¯ä»¥çœ‹åˆ°ï¼Œåœ¨å®šä¹‰æ¨¡å—æ—¶çš„è¯­æ³•ï¼Œvuex-module-decoratorsæ˜¯æ›´ä¼˜é›…ä¸€äº›çš„ï¼Œè€Œåœ¨ä½¿ç”¨æ—¶ï¼Œvuex-classæ˜¯æ›´èƒœä¸€ç­¹çš„ã€‚

- ä¸¤è€…ç»“åˆï¼Ÿ

ä¸¤è€…ç»“åˆä¹Ÿæ˜¯å®Œå…¨å¯ä»¥çš„ï¼Œç¬”è€…ä¹Ÿæ›¾è¯•éªŒè¿‡ï¼Œç¡®å®å¯ä»¥ã€‚é‚£è¿™æ ·å²‚ä¸æ˜¯å®Œç¾æ¥ï¼Ÿé‚£ä¸ç¦è¦é—®äº†ï¼Œä¸ºä½•è¿˜è¦æ”¾å¼ƒvuex-classå‘¢ï¼Ÿç©¶å…¶åŸå› ï¼Œæ˜¯å› ä¸ºvuex-classåœ¨ä½¿ç”¨æ—¶ï¼Œéƒ¨åˆ†åœ°æ–¹ä¼šå¤±å»tsçš„ç±»å‹æ”¯æŒï¼Œè€Œåªèƒ½æŒ‡å®šä¸ºanyã€‚è¿™ä½¿å¾—æˆ‘ä»¬åœ¨æŸç§ç¨‹åº¦ä¸Šå¤±å»å¼•å…¥tsçš„æ„ä¹‰ï¼Œæ•…è€Œç¬”è€…æ›´å¤šçš„é€‰åçš„å¦å¤–ä¸€ä¸ªã€‚å…·ä½“çš„ä¾‹å­ï¼Œç°åœ¨ä¹Ÿä¸æƒ³æ¼”ç¤ºäº†ï¼Œä¹Ÿæˆ–è®¸æ˜¯æœ‰æ›´å¥½çš„å¤„ç†æ–¹å¼ï¼Œè€Œç¬”è€…æœªæ›¾å‘ç°å§ï¼Œæœ‰æ¸…æ¥šçš„å°ä¼™ä¼´ä¹Ÿæ¬¢è¿æŒ‡å‡ºã€‚

### âœ¨ Eslintä¸è¯†åˆ«â€œåˆ«åâ€çš„å¤„ç†


![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/6/16/172bad6a91e2ebc8~tplv-t2oaga2asx-image.image)

- å®‰è£…eslintæ’ä»¶

```bash
# å¦‚æœeslint-plugin-importå·²å®‰è£…ï¼Œåˆ™ä¸éœ€è¦é‡å¤å®‰è£…
cnpm install eslint-plugin-import  eslint-import-resolver-alias --save-dev
```

- .eslintrc.jsæ–‡ä»¶å¢åŠ é…ç½®
```javascript
// ...çœç•¥å…¶ä»–

settings: {
    'import/resolver': {
      alias: {
        map: [
          ['@', './src'],
        ],
        extensions: ['.ts', '.js', '.jsx', '.json']
      }
    }
}

// ...çœç•¥å…¶ä»–
```

[eslint-import-resolver-aliasæ–‡æ¡£](https://github.com/johvin/eslint-import-resolver-alias)


### âœ¨ å¢å¼ºç±»å‹ï¼Œå¤„ç†å…¨å±€æŒ‚è½½é—®é¢˜

```
// å¦‚æœéœ€è¦åœ¨Vue.prototypeä¸ŠæŒ‚è½½ä¸€ä¸ªæ–¹æ³•ï¼Œä¾‹å¦‚:
// ä»…æ¼”ç¤ºç”¨æ³•
const noticeDefaultConfig = {
  duration: 2,
};
Vue.prototype.$success = (msg = '', config = {}) => {
  Vue.prototype.$Notice.success({
    title: msg,
    ...noticeDefaultConfig,
    ...config,
  });
};

// è¿™æ—¶å€™å¦‚æœç›´æ¥ä½¿ç”¨ï¼Œ
// åˆ™ä¼šåœ¨ç¼–è¯‘é˜¶æ®µæŠ¥é”™$successä¸å­˜åœ¨ï¼Œ
// æ‰€ä»¥éœ€è¦å¤„ç†ï¼Œç»™vueå¢å¼ºç±»å‹

// src/shims-vue.d.ts
import Vue from 'vue'
import VueRouter, { Route } from 'vue-router'

// åŸæœ‰çš„
declare module '*.vue' {
  import Vue from 'vue';

  export default Vue;
}
// å¢åŠ çš„æ‰©å±•
// å¢å¼ºæ‰©å±•vueçš„ç±»å‹
declare module 'vue/types/vue' {
  interface Vue {
    $router: VueRouter
    $route: Route
    $success: Function
  }
}
```


### âœ¨ ä¸æ”¯æŒtsçš„ç¬¬ä¸‰æ–¹åº“å¦‚ä½•å¤„ç†

- å»@typesä¸­å»å¯»æ‰¾

```
// ç¤¾åŒºç»´æŠ¤äº†@types/xxxçš„åº“
// ç›®å‰ä¸»æµçš„jsåº“ï¼Œ@types/ä¸ŠåŸºæœ¬ä¸Šéƒ½æœ‰ç»´æŠ¤å…¶tsç‰ˆæœ¬
// æ‰€ä»¥ç›´æ¥ä¸Šnpmå»æœç´¢ï¼Œä¾‹å¦‚lodash
@types/lodash

// å¦‚æœæœ‰çš„è¯åˆ™ç›´æ¥å®‰è£…ä½¿ç”¨,
// æ³¨æ„å®‰è£…åœ¨æœ¬åœ°å¼€å‘ä¾èµ–å°±å¥½
cnpm i @types/lodash -D
```

å¯¹äº@typesæ²¡æœ‰æ”¯æŒåˆ°çš„åº“è¯¥æ€ä¹ˆåŠï¼Ÿ

- è‡ªå·±ç»™åº“å¢åŠ tsæ”¯æŒï¼Œé™äºç¯‡å¹…ï¼Œæ›´å¤šçš„å†…å®¹å¯ä»¥æŸ¥çœ‹tsæ–‡æ¡£ã€‚åç»­å¦‚æœå¯ä»¥ï¼Œä¼šè€ƒè™‘å†™ç¯‡tsçš„å†…å®¹ï¼Œå†è¯¦ç»†è¯´å§ã€‚

### âœ¨ interfaceå¦‚ä½•ç»„ç»‡

æœ€åè¯´ä¸‹interraceï¼Œéšç€interfaceå¥½typeå£°æ˜çš„è¶Šæ¥è¶Šå¤šï¼ŒæŠŠinterfaceæŒ‰æ¨¡å—é›†ä¸­ç®¡ç†èµ·æ¥æˆ–è®¸ä¼šæ›´å¥½ã€‚

![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/6/16/172b8efd7e745541~tplv-t2oaga2asx-image.image)

### âœ¨ Componentså¦‚ä½•ç»„ç»‡

è¯´åˆ°componentsæ–‡ä»¶å¤¹ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„å…¬å…±ç»„ä»¶ï¼Œè¿™å—æˆ‘æ›´å€¾å‘äºä½¿ç”¨index.tsæ–‡ä»¶å¯¹æ‰€æœ‰çš„ç»„ä»¶ç»Ÿä¸€è¿›è¡Œå¯¼å…¥å¯¼å‡ºã€‚è¿™æ ·åœ¨å¼•å…¥ç»„ä»¶çš„æ—¶å€™ï¼Œå°±ä¸å¿…å…³æ³¨ç»„ä»¶å®é™…çš„ä½ç½®äº†ï¼Œåªéœ€è¦é€šè¿‡ä»components/indexè¿›è¡Œå¯¼å…¥ã€‚æ¥çœ‹ä¸‹componentsæ–‡ä»¶å¤¹ç›®å½•ï¼š

![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/6/16/172bb2d882013fb6~tplv-t2oaga2asx-image.image)

å¯¹äºç»„ä»¶æ–‡ä»¶çš„å‘½åï¼Œå¤§å®¶å¯ä»¥å‚è€ƒå®˜ç½‘æ–‡æ¡£çš„å»ºè®®ï¼Œæœ€ç»ˆè¿˜æ˜¯ä»¥å›¢é˜Ÿè§„èŒƒä¸ºä¸»ã€‚æ¯”å¦‚æˆ‘ä»¬è¿™é‡ŒåŸºç¡€ç»„ä»¶å…¨éƒ¨Baseå¼€å¤´ï¼Œå¯¹äºä¸€ä¸ªç»„ä»¶åœ¨ä¸€ä¸ªæ¨¡å—ä¸­åªä¼šä½¿ç”¨ä¸€æ¬¡çš„ç»„ä»¶ï¼Œä»¥Theå¼€å¤´ã€‚å…¨éƒ¨é‡‡ç”¨å¤§é©¼å³°å‘½åï¼ŒåŒ…æ‹¬ç»„ä»¶è°ƒç”¨ä¹Ÿæ˜¯ã€‚è¿™ä¸ªå…·ä½“çš„çœ‹è§„èŒƒå§ã€‚å†çœ‹ä¸‹index.tsæ–‡ä»¶å¦‚ä½•ç»„ç»‡ï¼š

```
export { default as BaseButton } from './BaseButton/index.vue';
export { default as BaseSideContainer } from './BaseSideContainer/index.vue';
export { default as BaseNofify } from './baseNotify/index.vue';

// ...çœç•¥å…¶ä»–
```

å†æ¥çœ‹ä¸‹å¯¼å…¥æ—¶ï¼š

```
import { BasePopoverConfirm } from '@/components';
```

æœ€å¤§çš„å¥½å¤„è¿˜æ˜¯åœ¨å¤–éƒ¨ä¸éœ€è¦careç»„ä»¶çš„ç»„ä»¶æ–‡ä»¶å¤¹ç»“æ„å’Œç»„ä»¶ä½ç½®å…³ç³»ã€‚componentså†…ç»„ä»¶çš„ç»„ç»‡ç»“æ„å‘ç”Ÿå˜åŒ–ï¼Œæ˜¯å®Œå…¨ä¸ä¼šå½±å“åˆ°å¤–éƒ¨çš„å¼•å…¥è·¯å¾„çš„ã€‚

## æ›´æ–°ï¼ˆ2020-08-13ï¼‰

### âœ¨ å¤„ç†ç¬¬ä¸‰æ–¹åº“æŒ‚è½½åœ¨vueåŸå‹ä¸Šçš„æ–¹æ³•çš„ç±»å‹å®šä¹‰

- æ¨è

æœ€å¥½çš„åšæ³•ç›´æ¥åœ¨src/shims-vue.d.tsä¸­ï¼ŒæŠŠå…¶å®šä¹‰çš„æ–‡ä»¶ç±»å‹å…¨éƒ¨å¯¼å…¥è¿›æ¥ï¼Œä¾¿ä¼šè‡ªåŠ¨åˆå¹¶äº†ã€‚

```
import Vue from 'vue'
import 'vue-router/types/vue'
import 'element-ui/types'

declare module '*.vue' {
  import Vue from 'vue';

  export default Vue;
}
```

å¦‚å›¾ï¼Œæƒ³element-uiå·²ç»æŠŠéœ€è¦åˆå¹¶çš„ç±»å‹ï¼Œå·²ç»åˆå¹¶è¿‡äº†ï¼Œæˆ‘ä»¬åªéœ€è¦å¼•å…¥å³å¯ï¼š

![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b1cc9e0a145b4aaea5a1d640703d2be7~tplv-k3u1fbpfcp-zoom-1.image)


åŒç†ï¼Œåƒvue-routerä¹Ÿæ˜¯ä¸€æ ·ï¼š

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c1a7334c92a14878a0ea87c33e2585af~tplv-k3u1fbpfcp-zoom-1.image)

- è€çš„åšæ³•

éœ€è¦è‡ªå·±æ‰‹åŠ¨å¯¼å…¥ç„¶ååˆå¹¶åˆ°vueè¿™ä¸ªæ¥å£ä¸Š
```
import Vue from 'vue'
import VueRouter, { Route } from 'vue-router'
import { Message } from 'view-design/types/message.d'

declare module '*.vue' {
  import Vue from 'vue';

  export default Vue;
}

declare module 'vue/types/vue' {
  interface Vue {
    $router: VueRouter
    $route: Route
    $success: Function
    $error: Function
    $Message: Message
  }
}
```

### âœ¨ åŠ¨æ€æ·»åŠ è·¯ç”±

ä»¥vueä¸ºä¾‹ï¼Œç»å¸¸é‡è§çš„åœºæ™¯æ˜¯é€šè¿‡router.addRouteåŠ¨æ€æ³¨å†Œè·¯ç”±ã€‚

åªéœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œé€šé…ç¬¦åŒ¹é…è·¯ç”±ã€‚**ä¸€å®šè¦æ”¾åœ¨æœ€å!ä¸€å®šè¦æ”¾åœ¨æœ€å!ä¸€å®šè¦æ”¾åœ¨æœ€å!**

```
@Mutation
  private [types.GENERATE_USER_ROUTES]() {
    const routes: any = [];
    (this.userAuths || []).forEach((auth) => {
      if (auth.children?.length) {
        auth.children.forEach((item) => {
          const curRoute = dynamicDicts.find((e) => e.name === item.name);
          if (curRoute) routes.push(curRoute);
        });
      }
    });
    // æ³¨æ„ï¼Œæ·»åŠ åˆ°æœ€å
    routes.push(route404);
    this.userRoutes = routes;
}
```

### âœ¨ ä»¥æ’ä»¶å½¢å¼å¼€å‘å…¨å±€filters

æ’ä»¶çš„åŸºæœ¬æ ¼å¼å°±ä¸è¯´äº†ï¼Œå…·ä½“çš„ç›®å½•ç»“æ„ä¹Ÿä¸å¤šè¯´ã€‚è¿™é‡Œåªå¼ºè°ƒä¸€ç‚¹ï¼Œå°±æ˜¯vmçš„ç±»å‹ï¼Œä½¿ç”¨`typeof Vue`ã€‚åŒç†å…¶ä»–åƒæ’ä»¶ç­‰ç­‰éœ€è¦ä½¿ç”¨vueå®ä¾‹çš„åœ°æ–¹ã€‚

```
import Vue from 'vue';
import dayjs from 'dayjs';
import { isFalsy, Falsey } from 'utility-types';
import { DateFormat } from '@/store/constant';

export default {
  install(vm: typeof Vue) {
    // æ ¼å¼åŒ–æ—¥æœŸ
    vm.filter('formatDate', (t: string | number | Date | Falsey, format = DateFormat.default) => {
      if (isFalsy(t)) return '-';
      return dayjs(t).format(format);
    });
  },
};

### âœ¨ tsä¸­å…±äº«less/scssç­‰çš„å˜é‡

æ¯”å¦‚é¡¹ç›®ä¸­å¾ˆå¸¸è§çš„åœºæ™¯ï¼Œæˆ‘ä»¬åœ¨ä¸€äº›ç»„ä»¶ä¸­éœ€è¦ä½¿ç”¨æˆ‘ä»¬çš„ä¸»é¢˜è‰²ç­‰ï¼Œè€Œè¿™äº›é¢œè‰²å¾ˆå¤šæ—¶å€™æ˜¯é€šè¿‡lessã€sassç­‰å˜é‡å®šä¹‰çš„ã€‚é‚£ä¹ˆè¿™å°±éœ€è¦æˆ‘ä»¬å¤„ç†åœ¨tsä¸­å…±äº«lessã€sasså˜é‡çš„éœ€æ±‚äº†ï¼ˆä½¿ç”¨css-in-jsçš„é™¤å¤–ï¼Œä½†æ˜¯css-in-jsä¹Ÿä¼šæœ‰ä¸€äº›ä¸èˆ’æœçš„åœ°æ–¹ï¼‰ã€‚å½“ç„¶äº†ï¼Œæˆ‘ä»¬å¯ä»¥ä¸åœ¨jsä¸­ä½¿ç”¨lesså˜é‡ï¼Œä½†æ˜¯è¿™æ ·æˆ‘ä»¬å°±éœ€è¦å†å¸¸äº®é‡Œé¢å†å®šä¹‰ä¸€æ¬¡ï¼Œè¿™æ˜¯æ²¡å¿…è¦çš„ä¹Ÿæ˜¯å†—ä½™çš„ã€‚ä¸‹é¢çœ‹çœ‹å¦‚ä½•å…±äº«å˜é‡ï¼š

- å®šä¹‰lessç­‰å˜é‡

var.lessæ–‡ä»¶ä¸­å®šä¹‰lesså˜é‡

```css
/* ä¸»è‰² */
@primary-color: #007EE6;

/* ä¸»èƒŒæ™¯è‰² */
@primary-bg: #f0f2f5;

/**
 * :exportæŒ‡ä»¤æ˜¯webpackæä¾›çš„ç”¨äºåœ¨jså’Œlessä¸­å…±äº«å˜é‡çš„åŠŸèƒ½
 * https://mattferderer.com/use-sass-variables-in-typescript-and-javascript
 */
:export {
  primaryColor: @primary-color;
}
```

ä¸Šé¢åªæœ‰æ³¨æ„`:export`æ˜¯webpackæä¾›çš„ä¸€ä¸ªç”¨äºåœ¨jså’Œless/sassç­‰csså¤„ç†å™¨ä¹‹é—´å…±äº«å˜é‡çš„æ–¹å¼å°±å¥½ã€‚ä½†æ˜¯ï¼Œè¿˜éœ€è¦æ³¨æ„çš„æ—¶å€™ï¼Œåœ¨tsé‡Œé¢ï¼Œå¦‚æœç›´æ¥ä½¿ç”¨ï¼Œè¿˜æ˜¯ä¼šæŠ¥é”™æœªç±»å‹çš„é”™è¯¯ï¼Œæ‰€ä»¥è¿™å°±éœ€è¦æˆ‘ä»¬ç»™å˜é‡æ–‡ä»¶å†™å£°æ˜æ–‡ä»¶äº†ã€‚

- å®šä¹‰var.lessæ–‡ä»¶çš„å£°æ˜æ–‡ä»¶

å› ä¸ºæ˜¯lessæ–‡ä»¶ï¼Œå¿…é¡»è¦å£°æ˜ï¼Œä¸ç„¶æŠ¥ç±»å‹å£°æ˜ä¸å­˜åœ¨çš„é—®é¢˜ï¼ŒåŒçº§ç›®å½•ä¸‹åˆ›å»ºvar.less.d.tsæ–‡ä»¶ï¼š

```
export interface LessVariables {
  primaryColor: string
}

export const variables: LessVariables

export default variables
```

- ä½¿ç”¨

```
// å¯¼å…¥lesså˜é‡æ–‡ä»¶
import variables from '@/styles/var.less';

// ç›´æ¥ä½¿ç”¨å³å¯
/** é¼ æ ‡åˆ’è¿‡æ—¶å›¾æ ‡çš„é¢œè‰² */
  @Prop({ type: String, default: variables.primaryColor }) hoverColor!: string
// ä¹Ÿå¯ä»¥ç”¨åœ¨è®¡ç®—å±æ€§ç­‰
```

### âœ¨ interfaceç®¡ç†

å»ºè®®åœ¨srcç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªinterfaceæ–‡ä»¶å¤¹ï¼ŒæŒ‰æ¨¡å—åˆ’åˆ†ï¼Œç”¨äºä¸“é—¨ç®¡ç†æ‰€æœ‰çš„æ¥å£å’Œtypeç­‰ã€‚å¦‚å›¾ï¼š

![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/592be40998a748c7957e0a6819a1f340~tplv-k3u1fbpfcp-zoom-1.image)

### ğŸ‘ğŸ‘ğŸ‘æœ€å

å¸Œæœ›å°ä¼™ä¼´ä»¬å†çœ‹å®Œæœ¬ç¯‡æ–‡ç« ï¼Œè¿˜æ²¡æœ‰ä½¿ç”¨vue+tså¼€å‘çš„å°ä¼™ä¼´ä»¬èƒ½æ—©æ—¥åœ¨å®é™…é¡¹ç›®ä¸­å¼€å‘ä½¿ç”¨ã€‚æˆ‘ç›¸ä¿¡æŒæ¡äº†è¿™äº›ï¼Œè¿›è¡Œvue+tså¼€å‘å®é™…é¡¹ç›®åº”è¯¥æ˜¯åŸºæœ¬OKçš„ã€‚å¸Œæœ›æœ¬æ–‡å¯¹æƒ³ä½¿ç”¨tsçš„å°ä¼™ä¼´æœ‰é‚£ä¹ˆä¸€ä¸¢ä¸¢å¸®åŠ©ï¼Œè®°å¾—æ”¶è—ç‚¹èµå“¦ï¼ï¼ï¼



> ç™¾å°ºç«¿å¤´ã€æ—¥è¿›ä¸€æ­¥
> æˆ‘æ˜¯ä½ ä»¬çš„è€æœ‹å‹æ„£é”¤ï¼Œå¦‚æœè§‰å¾—å–œæ¬¢ï¼Œæ¬¢è¿ç‚¹èµæ”¶è—ï¼ï¼ï¼