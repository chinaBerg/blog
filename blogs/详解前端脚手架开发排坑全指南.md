<section id="nice" data-tool="mdnice编辑器" data-website="https://www.mdnice.com" style="padding: 0 10px; word-spacing: 0px; word-wrap: break-word; text-align: left; font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, 'PingFang SC', Cambria, Cochin, Georgia, Times, 'Times New Roman', serif; line-height: 1.6; letter-spacing: .034em; color: rgb(63, 63, 63); font-size: 16px; word-break: all;"><p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">我们业务中可以通过Vue-cli脚手架快速生成vue项目，同样我们也可以开发一款cli脚手架用于快速生成我们日常提炼出来的业务基础模型/架构。本文将详细讲解脚手架如何开发，所涉及到的技术细节和坑以及各种第三方包的讲解，确保即使是小白同学也可以照着做出来自己的cli。</p>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">装逼大法！提升逼格！！升职加薪！！！赢娶白富美！！！！你还在等什么？快快开始吧～～～</p>
<figure data-tool="mdnice编辑器" style="margin: 0; margin-top: 10px; margin-bottom: 10px; display: flex; flex-direction: column; justify-content: center; align-items: center;"><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/7/9/1733431636884602~tplv-t2oaga2asx-image.image" alt="感觉像做梦一样" style="display: block; margin: 0 auto; max-width: 100%; border-radius: 4px; margin-bottom: 25px;"><figcaption style="margin-top: 5px; text-align: center; color: #888; display: block; font-size: 12px; font-family: PingFangSC-Light;">感觉像做梦一样</figcaption></figure>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">言归正传，首先思考一下我们的脚手架要帮助我们做什么事情？比如，这里我们就实现一个<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">vta-cli</code>，通过在终端运行一个<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">vta create my-app</code>就可以初始化我们日出提炼出来的一套<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">Vue+Ts+ElementUi</code>的RBAC系统的基础项目架构。有了这个目标，我们就可以拆解要实现的步骤了：</p>
<ul data-tool="mdnice编辑器" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">支持终端命令<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">vta</code></section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;"><code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">vta create my-app</code>命令运行后，检查当前文件名的存在与否情况</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">拉取们git上的模板项目到本地</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">拷贝当前下载的资源到我们目标地址</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">更新package.json等文件内容（比如name、author、version字段更改等）</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">在项目中初始化Git来管理项目</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">自动安装当前项目所需要的依赖</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">运行app</section></li></ul>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">👇下面我们就一步一步讲解具体实现过程，跟上队别掉队哈～～～</p>
<h3 data-tool="mdnice编辑器" style="margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 20px; margin-top: 1.2em;"><span style="background-image: url(http://img.xiaogangzai.cn/title_h2.png); background-size: 100% 100%; background-repeat: no-repeat; display: inline-block; width: 16px; height: 15px; line-height: 15px; margin-bottom: -1px;"></span><span class="prefix" style="display: none;"></span><span class="content" style="font-size: 17px; font-weight: bold; display: inline-block; margin-left: 8px; color: #48b378;">✨✨初始化项目基础架构</span><span class="suffix" style="display: none;"></span></h3>
<ul data-tool="mdnice编辑器" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">首先创建文件夹，手动点击创建也行，终端运行命令也行：</section></li></ul>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #f8f8f8; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #333; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #f8f8f8; border-radius: 5px;"><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;"># 终端创建项目根文件夹并进入到根文件夹</span>
<span/>mkdir vta-cli &amp;&amp; <span class="hljs-built_in" style="color: #0086b3; line-height: 26px;">cd</span> vta-cli
<span/>
<span/><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;"># 创建bin和src文件夹</span>
<span/>mkdir bin src
<span/>
<span/><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;"># bin下创建init.js作为脚本的入口文件</span>
<span/><span class="hljs-built_in" style="color: #0086b3; line-height: 26px;">cd</span> bin &amp;&amp; touch init.js
<span/>
<span/><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;"># 并在init.js中键入如下内容：</span>
<span/><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">#!/usr/bin/env node</span>
<span/>console.log(<span class="hljs-string" style="color: #d14; line-height: 26px;">'Hello，my bin！'</span>)
<span/>
<span/><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;"># 初始化npm的包管理文件, 根目录下执行</span>
<span/><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;"># 该命令会询问你很多配置参数，如果不想询问直接在后面加-y参数即可</span>
<span/>npm init
<span/></code></pre>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">项目基本的目录文件夹出来了，说下具体的目录作用，bin文件夹用于存放我们的命令入口文件，init.js作为入口文件（命名随你），src作为我们真正实现脚本命令逻辑的地方：</p>
<figure data-tool="mdnice编辑器" style="margin: 0; margin-top: 10px; margin-bottom: 10px; display: flex; flex-direction: column; justify-content: center; align-items: center;"><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/7/9/17334426ff046426~tplv-t2oaga2asx-image.image" alt="vta-cli项目目录文件夹" style="display: block; margin: 0 auto; max-width: 100%; border-radius: 4px; margin-bottom: 25px;"><figcaption style="margin-top: 5px; text-align: center; color: #888; display: block; font-size: 12px; font-family: PingFangSC-Light;">vta-cli项目目录文件夹</figcaption></figure>
<ul data-tool="mdnice编辑器" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">紧接着我们需要配置<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">package.json</code>文件，在里面添加我们的脚本命令。打开我们的<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">package.json</code>文件，在里面添加<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">bin</code>字段:</section></li></ul>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #f8f8f8; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #333; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #f8f8f8; border-radius: 5px;">{
<span/>    <span class="hljs-attr" style="line-height: 26px;">"bin"</span>: {
<span/>        <span class="hljs-attr" style="line-height: 26px;">"vta"</span>: <span class="hljs-string" style="color: #d14; line-height: 26px;">"bin/init.js"</span>
<span/>    },
<span/>}
<span/></code></pre>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">这就是我们定义了vta这个可以在终端运行的脚本命令，即运行<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">vta</code>这个命令的时候，程序会去运行我们配置的<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">bin/init.js</code>这个脚本文件。其实，根据npm的机制，当<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">install</code>一个包的时候，会自动去查询其定义的bin命令，并把他添加到<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">node_modules/.bin</code>文件中去，作为shell的命令可以去执行。因此当你的包安装到局部的项目中，那么其bin中的命令就是局部可运行的，安装到全局中则变成了全局可以运行的命令。</p>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">说明一下，并不是一定要是js文件，其实在linux系统中一切皆文件，是没有后缀名的规定的，至少为了让“人”好识别而已。</p>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;"><strong style="font-weight: bold; line-height: 1.75em; color: rgb(74,74,74);">重点强调一下：init.js文件的第一行，一定是第一行，我们添加了<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">#!/usr/bin/env node</code>代码，是指定了我们脚本的运行环境，和自定在我们运行vta命令的时候添加了node命令作为前缀，即实际运行的是<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">node vta</code>。</strong></p>
<ul data-tool="mdnice编辑器" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">接下来，为了方便我们测试，我们需要将这个包发不到本地的全局环境。我们可以通过如下命令：</section></li></ul>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #f8f8f8; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #333; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #f8f8f8; border-radius: 5px;"><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;"># 终端运行命令（需在当前项目根目录下）</span>
<span/>npm link
<span/></code></pre>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">注意，npm link是当我们当前包link到本地的全局中，就好比如我们安装依赖时使用了<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">-g</code>参数把一些包装到了全局环境一样，是用来方便我们本地开发时测试的，他可以让我们开发的时候自动热更新。如果不清楚<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">npm link的</code>小伙伴，可以去npm官网查查<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">npm link的</code>用法再继续往下学习。</p>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">但是，我想说的时候，很多小伙伴在这块可能会踩坑：</p>
<ul data-tool="mdnice编辑器" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">首先，最好把你的npm的镜像源改为npm本身的镜像源（如果你指定了为淘宝等其他的话）；特别是你需要发布npm仓库的时候会失败。</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">其次，一定要在<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">package.json</code>的配置中<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">把node_modules</code>等无关的文件夹去掉（或者指定我们需要的），也可以通过<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">.gitignore</code>等配置文件忽略掉也可以，或者<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">.npmrc</code>等。在哪里设置都可以，因为npm配置取值是有一套先后顺序的规则，有兴趣的话可以移步npm文档查阅。这里演示一下如何在<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">package.json</code>文件的配置:</section></li></ul>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #f8f8f8; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #333; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #f8f8f8; border-radius: 5px;">{
<span/>    <span class="hljs-attr" style="line-height: 26px;">"files"</span>: [
<span/>        <span class="hljs-string" style="color: #d14; line-height: 26px;">"./bin"</span>,
<span/>        <span class="hljs-string" style="color: #d14; line-height: 26px;">"./src"</span>
<span/>    ],
<span/>}
<span/></code></pre>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">我们通过在package.json文件中指定files文件夹目录，即告诉npm我们实际应该包含的真正文件有哪些，比如我们只需要<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">bin和src</code>文件夹，一些默认的文件像<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">package.json</code>啊，其他的一些基础配置文件啊，即使你不添加，也会被默认包含进来的。这也是当我们把这个包发布到<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">npm</code>所需要配置的，也就是需要哪些文件发布到npm仓库上。</p>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">注意，也可以通过排除的字段，<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">exclude</code>。但是，很多时候指定我们需要哪些文件，可能更为方便哦！<strong style="font-weight: bold; line-height: 1.75em; color: rgb(74,74,74);">再强调一遍，node_modules一定要排除掉</strong>，不然npm link会巨慢而且会失败的概率大，小心踩坑～～</p>
<figure data-tool="mdnice编辑器" style="margin: 0; margin-top: 10px; margin-bottom: 10px; display: flex; flex-direction: column; justify-content: center; align-items: center;"><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/7/10/17334570cf04eda8~tplv-t2oaga2asx-image.image" alt="说的似乎很有道理表情包" style="display: block; margin: 0 auto; max-width: 100%; border-radius: 4px; margin-bottom: 25px;"><figcaption style="margin-top: 5px; text-align: center; color: #888; display: block; font-size: 12px; font-family: PingFangSC-Light;">说的似乎很有道理表情包</figcaption></figure>
<ul data-tool="mdnice编辑器" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">测试命令</section></li></ul>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #f8f8f8; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #333; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #f8f8f8; border-radius: 5px;"><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;"># 终端运行</span>
<span/>vta
<span/>
<span/><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;"># 那么脚本执行后，便会看到终端的输出</span>
<span/><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;"># 说明脚本执行成功了</span>
<span/></code></pre>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;"><strong style="font-weight: bold; line-height: 1.75em; color: rgb(74,74,74);">再次强调，init.js首行一定要添加沙棒，如下:</strong></p>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #f8f8f8; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #333; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #f8f8f8; border-radius: 5px;"><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">#!/usr/bin/env node</span>
<span/>console.log(<span class="hljs-string" style="color: #d14; line-height: 26px;">'运行测试'</span>)
<span/></code></pre>
<h3 data-tool="mdnice编辑器" style="margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 20px; margin-top: 1.2em;"><span style="background-image: url(http://img.xiaogangzai.cn/title_h2.png); background-size: 100% 100%; background-repeat: no-repeat; display: inline-block; width: 16px; height: 15px; line-height: 15px; margin-bottom: -1px;"></span><span class="prefix" style="display: none;"></span><span class="content" style="font-size: 17px; font-weight: bold; display: inline-block; margin-left: 8px; color: #48b378;">❤️❤️命令行界面的解决方案</span><span class="suffix" style="display: none;"></span></h3>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;"><code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">commander.js</code>是nodejs命令行界面的一个完整解决方案。可以帮助我们定义各种命令行命令/参数等等。比如我们想定义create命令啊，或者-v作为版本号查询的参数等等。那就先看下怎么使用吧：</p>
<ul data-tool="mdnice编辑器" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">安装</section></li></ul>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #f8f8f8; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #333; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #f8f8f8; border-radius: 5px;">cnpm install commander -S
<span/></code></pre>
<ul data-tool="mdnice编辑器" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">引入使用</section></li></ul>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #f8f8f8; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #333; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #f8f8f8; border-radius: 5px;">// 在init.js中引入
<span/>const { Command } = require(<span class="hljs-string" style="color: #d14; line-height: 26px;">'commander'</span>);
<span/>// 导入当前根目录下的package.json文件，
<span/>// 为了获取对应的字段值，比如版本version
<span/>const package = require(<span class="hljs-string" style="color: #d14; line-height: 26px;">'../package'</span>);
<span/>// 初始化
<span/>const program = new Command();
<span/></code></pre>
<ul data-tool="mdnice编辑器" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">定义版本命令和help命令的说明信息</section></li></ul>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #f8f8f8; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #333; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #f8f8f8; border-radius: 5px;"><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// </span>
<span/><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 如此，</span>
<span/>program
<span/>  .version(package.version, <span class="hljs-string" style="color: #d14; line-height: 26px;">'-v, --version'</span>, <span class="hljs-string" style="color: #d14; line-height: 26px;">'display version for vta-cli'</span>)
<span/>  .usage(<span class="hljs-string" style="color: #d14; line-height: 26px;">'&lt;command&gt; [options]'</span>);
<span/><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// </span>
<span/></code></pre>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">通过调用version方法，定义命令行命令版本的功能，我们便可以在命令行输入<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">vta -v</code>得到当前的版本信息。</p>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">调用usage方法，是定义的我们的辅助命令（help）的提示的文案标题，类似于定义table的表头的感觉，如下图，当我们输入vta -h时，就是定义的蓝色框框内展示的部分：</p>
<figure data-tool="mdnice编辑器" style="margin: 0; margin-top: 10px; margin-bottom: 10px; display: flex; flex-direction: column; justify-content: center; align-items: center;"><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/7/10/173345d4e3599076~tplv-t2oaga2asx-image.image" alt="版本信息演示代码" style="display: block; margin: 0 auto; max-width: 100%; border-radius: 4px; margin-bottom: 25px;"><figcaption style="margin-top: 5px; text-align: center; color: #888; display: block; font-size: 12px; font-family: PingFangSC-Light;">版本信息演示代码</figcaption></figure>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">注意，这里<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">version方法</code>的第三个参数，是我们定义的说明内容，如上图的红色部分。<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">help</code>默认也是这个值</p>
<ul data-tool="mdnice编辑器" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">定义命令行参数</section></li></ul>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #f8f8f8; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #333; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #f8f8f8; border-radius: 5px;"><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">/**
<span/> * 定义vta的参数
<span/> */</span> 
<span/>program
<span/>  .option(<span class="hljs-string" style="color: #d14; line-height: 26px;">'-y, --yes'</span>, <span class="hljs-string" style="color: #d14; line-height: 26px;">'run default action'</span>)
<span/>  .option(<span class="hljs-string" style="color: #d14; line-height: 26px;">'-f, --force'</span>, <span class="hljs-string" style="color: #d14; line-height: 26px;">'force all the question'</span>);
<span/>  
<span/><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">/**
<span/> * 可以通过判断，当用户输入了对应的这些参数时,
<span/> * 我们可以做一些操作:
<span/> */</span>
<span/><span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">if</span> (program.force) {
<span/>    <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// do something..</span>
<span/>}
<span/></code></pre>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">通过option方法，定义我们的命令行参数，比<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">如vta -f</code>，等同于<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">vta --force</code>。注意，第一个参数是定义命令行参数，包含一个短的名称（1个字符）和一个长的名称，不能多了。第二个参数，就是定义的说明内容。注意，<strong style="font-weight: bold; line-height: 1.75em; color: rgb(74,74,74);">判断部分的代码，只能使用长的名称，不能判断短的，例如<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">program.f</code></strong>。</p>
<ul data-tool="mdnice编辑器" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">创建一个子命令</section></li></ul>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">创建子命令是重要的一部分，比如我们使用<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">vue create my-app</code>创建项目时, <code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">create</code>就是vue命令的子命令，<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">my-app</code>是命令参数。这里我们也定义一个子命令：</p>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #f8f8f8; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #333; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #f8f8f8; border-radius: 5px;"><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">/**
<span/> * 调用command方法，创建一个create命令,
<span/> * 同时create命令后面必须跟一个命令参数
<span/> * 如果你在终端运行vta create不加名称，则会报错提示用户
<span/> */</span>
<span/>program.command(<span class="hljs-string" style="color: #d14; line-height: 26px;">'create &lt;name&gt;'</span>)
<span/>  <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 定义该命令的描述</span>
<span/>  .description(<span class="hljs-string" style="color: #d14; line-height: 26px;">'create a vta template project'</span>)
<span/>  <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 为该命令指定一些参数</span>
<span/>  <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 最后我们都可以解析到这些参数，然后根据参数实现对应逻辑</span>
<span/>  .option(<span class="hljs-string" style="color: #d14; line-height: 26px;">'-f, --force'</span>, <span class="hljs-string" style="color: #d14; line-height: 26px;">'忽略文件夹检查，如果已存在则直接覆盖'</span>)
<span/>  <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">/**
<span/>   * 最后定义我们的实现逻辑
<span/>   * source表示当前定义的name参数
<span/>   * destination则是终端的cmd对象，可以从中解析到我们需要的内容
<span/>   */</span>
<span/>  .action(<span class="hljs-function" style="line-height: 26px;">(<span class="hljs-params" style="line-height: 26px;">source, destination</span>) =&gt;</span> {
<span/>    <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">/**
<span/>     * 比如我们这里把实现逻辑放在了另一个文件中去实现，
<span/>     * 方便代码解耦,
<span/>     * 因为destination参数比较杂乱，其实还是在此处先解析该参数对应再传入使用吧
<span/>     * 可以定义一个解析的工具函数
<span/>     */</span>
<span/>    <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">new</span> CreateCommand(source, destination)
<span/>  });
<span/></code></pre>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">如图，看下<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">destination</code>对象到底是什么?还是满多的内容。我们需要关注的就是红色框框的这部分，这里就是我们定义的该命令的所有参数的列表，我们变量该列表，取图中蓝色的部分的值，解决<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">--</code>后面的部分，然后作为key到整个cmd对象中取匹配，其值就是用户输入的参数的值。</p>
<figure data-tool="mdnice编辑器" style="margin: 0; margin-top: 10px; margin-bottom: 10px; display: flex; flex-direction: column; justify-content: center; align-items: center;"><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/7/10/173346526fe7b1fd~tplv-t2oaga2asx-image.image" alt="cmd对象展示" style="display: block; margin: 0 auto; max-width: 100%; border-radius: 4px; margin-bottom: 25px;"><figcaption style="margin-top: 5px; text-align: center; color: #888; display: block; font-size: 12px; font-family: PingFangSC-Light;">cmd对象展示</figcaption></figure>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">比如，可能会定义一个解析的工具函数:</p>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #f8f8f8; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #333; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #f8f8f8; border-radius: 5px;"><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">/**
<span/> * parseCmdParams
<span/> * @description 解析用户输入的参数
<span/> * @param {} cmd Cammander.action解析出的cmd对象
<span/> * @returns { Object } 返回一个用户参数的键值对象
<span/> */</span>
<span/>exports.parseCmdParams = <span class="hljs-function" style="line-height: 26px;">(<span class="hljs-params" style="line-height: 26px;">cmd</span>) =&gt;</span> {
<span/>  <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">if</span> (!cmd) <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">return</span> {}
<span/>  <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">const</span> resOps = {}
<span/>  cmd.options.forEach(<span class="hljs-function" style="line-height: 26px;"><span class="hljs-params" style="line-height: 26px;">option</span> =&gt;</span> {
<span/>    <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">const</span> key = option.long.replace(<span class="hljs-regexp" style="color: #009926; line-height: 26px;">/^--/</span>, <span class="hljs-string" style="color: #d14; line-height: 26px;">''</span>);
<span/>    <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">if</span> (cmd[key] &amp;&amp; !isFunction(cmd[key])) {
<span/>      resOps[key] = cmd[key]
<span/>    }
<span/>  })
<span/>  <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">return</span> resOps
<span/>}
<span/></code></pre>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">上述的解析方法实现方式和我们vue-cli的差不多。</p>
<ul data-tool="mdnice编辑器" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">完成解析</section></li></ul>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #f8f8f8; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #333; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #f8f8f8; border-radius: 5px;"><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">/**
<span/> * 切记parse方法的调用，一定要program.parse()方式,
<span/> * 而不是直接在上面的链式调用之后直接xxx.parse()调用，
<span/> * 不然就会作为当前command的parse去处理了，从而help命令等都与你的预期不符合了
<span/> */</span>
<span/><span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">try</span> {
<span/>  program.parse(process.argv);
<span/>} <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">catch</span> (error) {
<span/>  <span class="hljs-built_in" style="color: #0086b3; line-height: 26px;">console</span>.log(<span class="hljs-string" style="color: #d14; line-height: 26px;">'err: '</span>, error)
<span/>}
<span/></code></pre>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">最后一定要解析，不解析是拿不到对应参数<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">program.parse(process.argv)</code>，也就是不会执行对应的命令等行为的。切记！切记！切记！！！更详细的命令请查询<a href="https://github.com/tj/commander.js#readme" style="word-wrap: break-word; font-weight: bold; color: #48b378; text-decoration: none; border-bottom: 1px solid #48b378;">commander文档</a>。</p>
<h3 data-tool="mdnice编辑器" style="margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 20px; margin-top: 1.2em;"><span style="background-image: url(http://img.xiaogangzai.cn/title_h2.png); background-size: 100% 100%; background-repeat: no-repeat; display: inline-block; width: 16px; height: 15px; line-height: 15px; margin-bottom: -1px;"></span><span class="prefix" style="display: none;"></span><span class="content" style="font-size: 17px; font-weight: bold; display: inline-block; margin-left: 8px; color: #48b378;">🌞对目标路径进行检查</span><span class="suffix" style="display: none;"></span></h3>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">从上面的步骤我们可以看出，我们已经定义好了<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">vta create &lt;name&gt;</code>的命令了，即当我们运行<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">vta create my-app</code>命令的时候，就会初始化我们定义的<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">CreateCommand</code>类了。下面我们看看入如何实现这个逻辑：我们首先创建<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">src/command/CreateCommand.js</code>这个文件来实现我们的逻辑：</p>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #f8f8f8; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #333; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #f8f8f8; border-radius: 5px;"><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">/**
<span/> * class 项目创建命令
<span/> *
<span/> * @description
<span/> * @param {} source 用户提供的文件夹名称
<span/> * @param {} destination 用户输入的create命令的参数
<span/> */</span>
<span/><span class="hljs-class" style="line-height: 26px;"><span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">class</span> <span class="hljs-title" style="color: #458; font-weight: bold; line-height: 26px;">Creator</span> </span>{
<span/>  <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">constructor</span>(source, destination, ops = {}) {
<span/>    <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">this</span>.source = source
<span/>    <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">this</span>.cmdParams = parseCmdParams(destination)
<span/>    <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">this</span>.RepoMaps = <span class="hljs-built_in" style="color: #0086b3; line-height: 26px;">Object</span>.assign({
<span/>      <span class="hljs-attr" style="line-height: 26px;">repo</span>: RepoPath, <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 配置文件中放置的远程地址常量</span>
<span/>      temp: path.join(__dirname, <span class="hljs-string" style="color: #d14; line-height: 26px;">'../../__temp__'</span>),
<span/>      <span class="hljs-attr" style="line-height: 26px;">target</span>: <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">this</span>.genTargetPath(<span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">this</span>.source)
<span/>    }, ops);
<span/>    <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">this</span>.gitUser = {};
<span/>    <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">this</span>.spinner = ora();
<span/>    <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">this</span>.init();
<span/>  }
<span/>  
<span/>  <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 其他实例方法</span>
<span/>  <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// ...</span>
<span/>}
<span/>
<span/><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 最终导出这个class</span>
<span/><span class="hljs-built_in" style="color: #0086b3; line-height: 26px;">module</span>.exports = Creator;
<span/></code></pre>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">我们看下这个构造函数我们用来做了什么事情，首先就是把实例化时传进来的参数赋值给this对象，供后面其他实例方法中去使用。然后定义了<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">RepoMaps</code>属性设置我们的一些基础参数，像项目模板的地址<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">repo</code>、我们本地cli项目内部临时存放的项目模板的地址<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">temp</code>、和最终我们需要把项目安装到的目标地址<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">taregt</code>。因为项目最终会安装到终端运行的地址下的位置，而你的脚手架包是被安装在其他地址的。</p>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">然后定义了gitUser用于存放用户的git信息，后面会通过自动执行命令获取相关的信息，然后最后我们会把信息塞到package.json文件中。</p>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;"><code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">this.spinner = ora();</code>就是实例化一个菊花图，当我们在执行命令的时候可以调用this.spinner方法进行菊花转呀转!</p>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">下面我们来实现这个init初始化的方法吧：</p>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #f8f8f8; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #333; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #f8f8f8; border-radius: 5px;"><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 初始化函数</span>
<span/><span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">async</span> init() {
<span/>    <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">try</span> {
<span/>      <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 检查目标路径文件是否正确</span>
<span/>      <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">await</span> <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">this</span>.checkFolderExist();
<span/>      <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 拉取git上的vue+ts+ele的项目模板</span>
<span/>      <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 存放在临时文件夹中</span>
<span/>      <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">await</span> <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">this</span>.downloadRepo();
<span/>      <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 把下载下来的资源文件，拷贝到目标文件夹</span>
<span/>      <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">await</span> <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">this</span>.copyRepoFiles();
<span/>      <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 根据用户git信息等，修改项目模板中package.json的一些信息</span>
<span/>      <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">await</span> <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">this</span>.updatePkgFile();
<span/>      <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 对我们的项目进行git初始化</span>
<span/>      <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">await</span> <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">this</span>.initGit();
<span/>      <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 最后安装依赖、启动项目等！</span>
<span/>      <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">await</span> <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">this</span>.runApp();
<span/>    } <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">catch</span> (error) {
<span/>      <span class="hljs-built_in" style="color: #0086b3; line-height: 26px;">console</span>.log(<span class="hljs-string" style="color: #d14; line-height: 26px;">''</span>)
<span/>      log.error(error);
<span/>      exit(<span class="hljs-number" style="color: #008080; line-height: 26px;">1</span>)
<span/>    } <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">finally</span> {
<span/>      <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">this</span>.spinner.stop();
<span/>    }
<span/>}
<span/></code></pre>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">从上面代码注释可以看到，我们的init方法，就是把一系列操作一次调用执行即可。最后先看一下配置文件吧：</p>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #f8f8f8; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #333; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #f8f8f8; border-radius: 5px;">exports.InquirerConfig = {
<span/>  <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 文件夹已存在的名称的询问参数</span>
<span/>  folderExist: [{
<span/>    <span class="hljs-attr" style="line-height: 26px;">type</span>: <span class="hljs-string" style="color: #d14; line-height: 26px;">'list'</span>,
<span/>    <span class="hljs-attr" style="line-height: 26px;">name</span>: <span class="hljs-string" style="color: #d14; line-height: 26px;">'recover'</span>,
<span/>    <span class="hljs-attr" style="line-height: 26px;">message</span>: <span class="hljs-string" style="color: #d14; line-height: 26px;">'当前文件夹已存在，请选择操作：'</span>,
<span/>    <span class="hljs-attr" style="line-height: 26px;">choices</span>: [
<span/>      { <span class="hljs-attr" style="line-height: 26px;">name</span>: <span class="hljs-string" style="color: #d14; line-height: 26px;">'创建一个新的文件夹'</span>, <span class="hljs-attr" style="line-height: 26px;">value</span>: <span class="hljs-string" style="color: #d14; line-height: 26px;">'newFolder'</span> },
<span/>      { <span class="hljs-attr" style="line-height: 26px;">name</span>: <span class="hljs-string" style="color: #d14; line-height: 26px;">'覆盖'</span>, <span class="hljs-attr" style="line-height: 26px;">value</span>: <span class="hljs-string" style="color: #d14; line-height: 26px;">'cover'</span> },
<span/>      { <span class="hljs-attr" style="line-height: 26px;">name</span>: <span class="hljs-string" style="color: #d14; line-height: 26px;">'退出'</span>, <span class="hljs-attr" style="line-height: 26px;">value</span>: <span class="hljs-string" style="color: #d14; line-height: 26px;">'exit'</span> },
<span/>    ]
<span/>  }],
<span/>  <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 重命名的询问参数</span>
<span/>  rename: [{
<span/>    <span class="hljs-attr" style="line-height: 26px;">name</span>: <span class="hljs-string" style="color: #d14; line-height: 26px;">'inputNewName'</span>,
<span/>    <span class="hljs-attr" style="line-height: 26px;">type</span>: <span class="hljs-string" style="color: #d14; line-height: 26px;">'input'</span>,
<span/>    <span class="hljs-attr" style="line-height: 26px;">message</span>: <span class="hljs-string" style="color: #d14; line-height: 26px;">'请输入新的项目名称: '</span>
<span/>  }]
<span/>}
<span/>
<span/><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 远程Repo地址</span>
<span/><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 大家开发阶段，如果没有自己的项目，可以先调用我的这个地址练习</span>
<span/><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 也可以随便一个地址练习都可以</span>
<span/>exports.RepoPath = <span class="hljs-string" style="color: #d14; line-height: 26px;">'github:chinaBerg/vue-typescript-admin'</span>
<span/></code></pre>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">后面我们将看看这一系列方法该如何实现？</p>
<h3 data-tool="mdnice编辑器" style="margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 20px; margin-top: 1.2em;"><span style="background-image: url(http://img.xiaogangzai.cn/title_h2.png); background-size: 100% 100%; background-repeat: no-repeat; display: inline-block; width: 16px; height: 15px; line-height: 15px; margin-bottom: -1px;"></span><span class="prefix" style="display: none;"></span><span class="content" style="font-size: 17px; font-weight: bold; display: inline-block; margin-left: 8px; color: #48b378;">🌞终端的菊花图工具</span><span class="suffix" style="display: none;"></span></h3>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">首先介绍一下我们的小菊花吧！我们在执行各种操作的时候，比如拉模板数据等等，都是会有一定等待实际的，那么这个等待过程，我们可以在终端有个小菊花转转转，这样
会给用户更好的体验，让用户知道当前脚本在执行加载，如图（最左侧有个小菊花在转转转～～～）：</p>
<figure data-tool="mdnice编辑器" style="margin: 0; margin-top: 10px; margin-bottom: 10px; display: flex; flex-direction: column; justify-content: center; align-items: center;"><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/7/10/17334694fb9d692e~tplv-t2oaga2asx-image.image" alt="转动的ora菊花图" style="display: block; margin: 0 auto; max-width: 100%; border-radius: 4px; margin-bottom: 25px;"><figcaption style="margin-top: 5px; text-align: center; color: #888; display: block; font-size: 12px; font-family: PingFangSC-Light;">转动的ora菊花图</figcaption></figure>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;"><a href="https://www.npmjs.com/package/ora" style="word-wrap: break-word; font-weight: bold; color: #48b378; text-decoration: none; border-bottom: 1px solid #48b378;">ora</a>就是这一款终端使用的菊花图工具，下面看看如何使用吧！</p>
<ul data-tool="mdnice编辑器" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">安装</section></li></ul>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #f8f8f8; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #333; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #f8f8f8; border-radius: 5px;">cnpm install ora -S
<span/></code></pre>
<ul data-tool="mdnice编辑器" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">使用</section></li></ul>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #f8f8f8; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #333; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #f8f8f8; border-radius: 5px;"><span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">const</span> ora = <span class="hljs-built_in" style="color: #0086b3; line-height: 26px;">require</span>(<span class="hljs-string" style="color: #d14; line-height: 26px;">'ora'</span>);
<span/>
<span/><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// ora参数创建spinner文字内容</span>
<span/><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 也可以传递一个对象，设置spinner的周期、颜色等</span>
<span/><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 调用start方法启动，最终返回一个实例</span>
<span/><span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">const</span> spinner = ora(<span class="hljs-string" style="color: #d14; line-height: 26px;">'Loading start'</span>)
<span/>
<span/><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 开启菊花转转</span>
<span/>spinner.start();
<span/>
<span/><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 停止</span>
<span/>spinner.stop()
<span/>
<span/><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 设置文案，后者菊花的color</span>
<span/>spinner.text = <span class="hljs-string" style="color: #d14; line-height: 26px;">'正在安装项目依赖文件，请稍后...'</span>;
<span/>spinner.color = <span class="hljs-string" style="color: #d14; line-height: 26px;">'green'</span>;
<span/>
<span/><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 显示转成功的状态</span>
<span/>spinner.succeed(<span class="hljs-string" style="color: #d14; line-height: 26px;">'package.json更新完成'</span>);
<span/></code></pre>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">注意，文案的颜色，还是得靠chalk辅助。后面会介绍chalk。上个图片演示一下实际的运用：</p>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">更多详细的用户请查阅<a href="https://www.npmjs.com/package/ora" style="word-wrap: break-word; font-weight: bold; color: #48b378; text-decoration: none; border-bottom: 1px solid #48b378;">ora文档</a>。</p>
<h3 data-tool="mdnice编辑器" style="margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 20px; margin-top: 1.2em;"><span style="background-image: url(http://img.xiaogangzai.cn/title_h2.png); background-size: 100% 100%; background-repeat: no-repeat; display: inline-block; width: 16px; height: 15px; line-height: 15px; margin-bottom: -1px;"></span><span class="prefix" style="display: none;"></span><span class="content" style="font-size: 17px; font-weight: bold; display: inline-block; margin-left: 8px; color: #48b378;">🌛五彩斑斓的控制台</span><span class="suffix" style="display: none;"></span></h3>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">chalk是一款可以让我们的控制台打印出各种颜色/背景的内容的工具，由此我们可以鲜明的区分各种提示内容，如下图（就问你骚不骚？？？）：</p>
<figure data-tool="mdnice编辑器" style="margin: 0; margin-top: 10px; margin-bottom: 10px; display: flex; flex-direction: column; justify-content: center; align-items: center;"><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/7/10/173346cfc64ce13c~tplv-t2oaga2asx-image.image" alt="chalk效果图" style="display: block; margin: 0 auto; max-width: 100%; border-radius: 4px; margin-bottom: 25px;"><figcaption style="margin-top: 5px; text-align: center; color: #888; display: block; font-size: 12px; font-family: PingFangSC-Light;">chalk效果图</figcaption></figure>
<ul data-tool="mdnice编辑器" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">安装</section></li></ul>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #f8f8f8; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #333; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #f8f8f8; border-radius: 5px;"><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;"># 终端运行</span>
<span/>cnpm i chalk -S
<span/></code></pre>
<ul data-tool="mdnice编辑器" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">使用</section></li></ul>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #f8f8f8; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #333; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #f8f8f8; border-radius: 5px;">const chalk = require(<span class="hljs-string" style="color: #d14; line-height: 26px;">'chalk'</span>);
<span/>
<span/>// 比如，这里定义一个<span class="hljs-built_in" style="color: #0086b3; line-height: 26px;">log</span>对象
<span/>exports.log = {
<span/>  warning(msg = <span class="hljs-string" style="color: #d14; line-height: 26px;">''</span>) {
<span/>    console.warning(chalk.yellow(`<span class="hljs-variable" style="color: #008080; line-height: 26px;">${msg}</span>`));
<span/>  },
<span/>  error(msg = <span class="hljs-string" style="color: #d14; line-height: 26px;">''</span>) {
<span/>    console.error(chalk.red(`<span class="hljs-variable" style="color: #008080; line-height: 26px;">${msg}</span>`));
<span/>  },
<span/>  success(msg = <span class="hljs-string" style="color: #d14; line-height: 26px;">''</span>) {
<span/>    console.log(chalk.green(`<span class="hljs-variable" style="color: #008080; line-height: 26px;">${msg}</span>`));
<span/>  }
<span/>}
<span/></code></pre>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">比如，上面我们封装了最简单的log方法，用于打印各种类型的信息时展示带颜色的内容。还有一点，我们说一下上面提到了的如何配合ora使用吧：</p>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #f8f8f8; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #333; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #f8f8f8; border-radius: 5px;">const chalk = require(<span class="hljs-string" style="color: #d14; line-height: 26px;">'chalk'</span>);
<span/>const ora = require(<span class="hljs-string" style="color: #d14; line-height: 26px;">'ora'</span>);
<span/>
<span/>const spinner = ora(<span class="hljs-string" style="color: #d14; line-height: 26px;">'Loading start'</span>)
<span/>
<span/>// 开启菊花转转
<span/>spinner.start(chalk.yellow(<span class="hljs-string" style="color: #d14; line-height: 26px;">'打印一个yellow色的文字'</span>));
<span/></code></pre>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">用法比较简单，不多说了，更多用法还是<a href="https://www.npmjs.com/package/chalk" style="word-wrap: break-word; font-weight: bold; color: #48b378; text-decoration: none; border-bottom: 1px solid #48b378;">查阅文档</a>吧！</p>
<h3 data-tool="mdnice编辑器" style="margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 20px; margin-top: 1.2em;"><span style="background-image: url(http://img.xiaogangzai.cn/title_h2.png); background-size: 100% 100%; background-repeat: no-repeat; display: inline-block; width: 16px; height: 15px; line-height: 15px; margin-bottom: -1px;"></span><span class="prefix" style="display: none;"></span><span class="content" style="font-size: 17px; font-weight: bold; display: inline-block; margin-left: 8px; color: #48b378;">✨fs-extra文件操作</span><span class="suffix" style="display: none;"></span></h3>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">在详细说明各个步骤实现的方式之前，我们先说一下在cli中使用的文件操作的库。node本身有fs操作，那么我们为什么还要引入<a href="https://www.npmjs.com/package/fs-extra" style="word-wrap: break-word; font-weight: bold; color: #48b378; text-decoration: none; border-bottom: 1px solid #48b378;">fs-extra</a>库呢？是因为他完全可以用来取代fs的库，省去了<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">mkdirp``rimraf``ncp</code>等库等安装引入。用于拷贝、读取、删除等文件操作，而且提供了更多的功能等等。</p>
<ul data-tool="mdnice编辑器" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">安装</section></li></ul>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #f8f8f8; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #333; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #f8f8f8; border-radius: 5px;">cnpm install fs-extra
<span/></code></pre>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">具体的api的方法，请查阅文档<a href="https://www.npmjs.com/package/fs-extra" style="word-wrap: break-word; font-weight: bold; color: #48b378; text-decoration: none; border-bottom: 1px solid #48b378;">fs-extra</a>，后面讲解各个步骤具体实现的时候也会提及到。</p>
<h3 data-tool="mdnice编辑器" style="margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 20px; margin-top: 1.2em;"><span style="background-image: url(http://img.xiaogangzai.cn/title_h2.png); background-size: 100% 100%; background-repeat: no-repeat; display: inline-block; width: 16px; height: 15px; line-height: 15px; margin-bottom: -1px;"></span><span class="prefix" style="display: none;"></span><span class="content" style="font-size: 17px; font-weight: bold; display: inline-block; margin-left: 8px; color: #48b378;">✨检查文件夹是否合法</span><span class="suffix" style="display: none;"></span></h3>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">到了我们运行<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">vta create my-app</code>的时候了，这时候我们就要考虑了，如果当前位置已经存在了同名的文件夹，那么我们肯定是不能直接覆盖的，而是要给用户选择，比如覆盖、重新创建一个新的文件夹、退出，如下图：</p>
<figure data-tool="mdnice编辑器" style="margin: 0; margin-top: 10px; margin-bottom: 10px; display: flex; flex-direction: column; justify-content: center; align-items: center;"><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/7/10/173373fb0c14a74f~tplv-t2oaga2asx-image.image" alt style="display: block; margin: 0 auto; max-width: 100%; border-radius: 4px; margin-bottom: 25px;"></figure>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">然后根据用户的不同选择作出对于的操作。下面我们看这个文件夹检查的具体实现：</p>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #f8f8f8; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #333; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #f8f8f8; border-radius: 5px;">checkFolderExist() {
<span/>    <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">return</span> <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">new</span> <span class="hljs-built_in" style="color: #0086b3; line-height: 26px;">Promise</span>(<span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">async</span> (resolve, reject) =&gt; {
<span/>      <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">const</span> { target } = <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">this</span>.RepoMaps
<span/>      <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 如果create附加了--force或-f参数，则直接执行覆盖操作</span>
<span/>      <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">if</span> (<span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">this</span>.cmdParams.force) {
<span/>        <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">await</span> fs.removeSync(target)
<span/>        <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">return</span> resolve()
<span/>      }
<span/>      <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">try</span> {
<span/>        <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 否则进行文件夹检查</span>
<span/>        <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">const</span> isTarget = <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">await</span> fs.pathExistsSync(target)
<span/>        <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">if</span> (!isTarget) <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">return</span> resolve()
<span/>
<span/>        <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">const</span> { recover } = <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">await</span> inquirer.prompt(InquirerConfig.folderExist);
<span/>        <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">if</span> (recover === <span class="hljs-string" style="color: #d14; line-height: 26px;">'cover'</span>) {
<span/>          <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">await</span> fs.removeSync(target);
<span/>          <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">return</span> resolve();
<span/>        } <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">else</span> <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">if</span> (recover === <span class="hljs-string" style="color: #d14; line-height: 26px;">'newFolder'</span>) {
<span/>          <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">const</span> { inputNewName } = <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">await</span> inquirer.prompt(InquirerConfig.rename);
<span/>          <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">this</span>.source = inputNewName;
<span/>          <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">this</span>.RepoMaps.target = <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">this</span>.genTargetPath(<span class="hljs-string" style="color: #d14; line-height: 26px;">`./<span class="hljs-subst" style="color: #333; font-weight: normal; line-height: 26px;">${inputNewName}</span>`</span>);
<span/>          <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">return</span> resolve();
<span/>        } <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">else</span> {
<span/>          exit(<span class="hljs-number" style="color: #008080; line-height: 26px;">1</span>);
<span/>        }
<span/>      } <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">catch</span> (error) {
<span/>        log.error(<span class="hljs-string" style="color: #d14; line-height: 26px;">`[vta]Error:<span class="hljs-subst" style="color: #333; font-weight: normal; line-height: 26px;">${error}</span>`</span>)
<span/>        exit(<span class="hljs-number" style="color: #008080; line-height: 26px;">1</span>);
<span/>      }
<span/>    })
<span/>  }
<span/></code></pre>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">具体讲解：</p>
<ol data-tool="mdnice编辑器" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: decimal;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">我们定义了这个方法，返回的是一个Promise对象。</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">我们判断用户在输入<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">vta create my-app</code>的时候有没有在后面加<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">-f</code>的参数，如果添加了参数则是告诉我们忽略检查直接往后走，就是默认覆盖的操作。通过调用<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">fs.removeSync(target);</code>方法进行移除需要覆盖的文件；</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">否则的话，我们则需要进行文件夹检查的实现逻辑了。通过<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">await fs.pathExistsSync(target)</code>逻辑进行判断当前文件夹名称是否已经存在，如果不存在则resolve告诉程序执行文件夹检查成功之后的程序。</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">如果同名的则给用户提示，让用户选择操作。下面将讲解如何在命令行进行交互。</section></li></ol>
<h3 data-tool="mdnice编辑器" style="margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 20px; margin-top: 1.2em;"><span style="background-image: url(http://img.xiaogangzai.cn/title_h2.png); background-size: 100% 100%; background-repeat: no-repeat; display: inline-block; width: 16px; height: 15px; line-height: 15px; margin-bottom: -1px;"></span><span class="prefix" style="display: none;"></span><span class="content" style="font-size: 17px; font-weight: bold; display: inline-block; margin-left: 8px; color: #48b378;">❤️命令行交互</span><span class="suffix" style="display: none;"></span></h3>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">说到命令行交互，就要提到一个比较程序的库<a href="https://www.npmjs.com/package/inquirer" style="word-wrap: break-word; font-weight: bold; color: #48b378; text-decoration: none; border-bottom: 1px solid #48b378;">inquirer</a>，这是一个用于node环境下进行命令行交互的库，支持单选、多选、用户输入、confirm询问等等操作。</p>
<ul data-tool="mdnice编辑器" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">安装</section></li></ul>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #f8f8f8; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #333; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #f8f8f8; border-radius: 5px;">cnpm i inquirer -S
<span/></code></pre>
<ul data-tool="mdnice编辑器" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">使用</section></li></ul>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #f8f8f8; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #333; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #f8f8f8; border-radius: 5px;"><span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">const</span> inquirer = <span class="hljs-built_in" style="color: #0086b3; line-height: 26px;">require</span>(<span class="hljs-string" style="color: #d14; line-height: 26px;">'inquirer'</span>);
<span/>
<span/><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 定义询问的参数</span>
<span/><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// type表示询问的类型，是单选、多选、确认等等</span>
<span/><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// name可以理解为当前交互的标识符，其值为交互的结果</span>
<span/><span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">const</span> InquirerConfig = {
<span/>  <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 文件夹已存在的名称的询问参数</span>
<span/>  folderExist: [{
<span/>    <span class="hljs-attr" style="line-height: 26px;">type</span>: <span class="hljs-string" style="color: #d14; line-height: 26px;">'list'</span>,
<span/>    <span class="hljs-attr" style="line-height: 26px;">name</span>: <span class="hljs-string" style="color: #d14; line-height: 26px;">'recover'</span>,
<span/>    <span class="hljs-attr" style="line-height: 26px;">message</span>: <span class="hljs-string" style="color: #d14; line-height: 26px;">'当前文件夹已存在，请选择操作：'</span>,
<span/>    <span class="hljs-attr" style="line-height: 26px;">choices</span>: [
<span/>      { <span class="hljs-attr" style="line-height: 26px;">name</span>: <span class="hljs-string" style="color: #d14; line-height: 26px;">'覆盖'</span>, <span class="hljs-attr" style="line-height: 26px;">value</span>: <span class="hljs-string" style="color: #d14; line-height: 26px;">'cover'</span> },
<span/>      { <span class="hljs-attr" style="line-height: 26px;">name</span>: <span class="hljs-string" style="color: #d14; line-height: 26px;">'创建一个新的文件夹'</span>, <span class="hljs-attr" style="line-height: 26px;">value</span>: <span class="hljs-string" style="color: #d14; line-height: 26px;">'newFolder'</span> },
<span/>      { <span class="hljs-attr" style="line-height: 26px;">name</span>: <span class="hljs-string" style="color: #d14; line-height: 26px;">'退出'</span>, <span class="hljs-attr" style="line-height: 26px;">value</span>: <span class="hljs-string" style="color: #d14; line-height: 26px;">'exit'</span> },
<span/>    ]
<span/>  }],
<span/>  <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 重命名的询问参数</span>
<span/>  rename: [{
<span/>    <span class="hljs-attr" style="line-height: 26px;">name</span>: <span class="hljs-string" style="color: #d14; line-height: 26px;">'inputNewName'</span>,
<span/>    <span class="hljs-attr" style="line-height: 26px;">type</span>: <span class="hljs-string" style="color: #d14; line-height: 26px;">'input'</span>,
<span/>    <span class="hljs-attr" style="line-height: 26px;">message</span>: <span class="hljs-string" style="color: #d14; line-height: 26px;">'请输入新的项目名称: '</span>
<span/>  }]
<span/>}
<span/>
<span/><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 使用</span>
<span/><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 通过当前标识符获取交互的结果</span>
<span/><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 比如，如下是一个单选的演示</span>
<span/><span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">const</span> { recover } = <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">await</span> inquirer.prompt(InquirerConfig.folderExist);
<span/>
<span/><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 如果用户选中的是“覆盖”选项</span>
<span/><span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">if</span> (recover === <span class="hljs-string" style="color: #d14; line-height: 26px;">'cover'</span>) {
<span/>  <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">await</span> fs.removeSync(target);
<span/>  <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">return</span> resolve();
<span/><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 如果用户选中的是“创建新文件夹”选中</span>
<span/>} <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">else</span> <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">if</span> (recover === <span class="hljs-string" style="color: #d14; line-height: 26px;">'newFolder'</span>) {
<span/>  <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 再次创建一个用户输入的交互操作</span>
<span/>  <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 让用户输入新的文件夹名称</span>
<span/>  <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">const</span> { inputNewName } = <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">await</span> inquirer.prompt(InquirerConfig.rename);
<span/>  <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">this</span>.RepoMaps.target = <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">this</span>.genTargetPath(<span class="hljs-string" style="color: #d14; line-height: 26px;">`./<span class="hljs-subst" style="color: #333; font-weight: normal; line-height: 26px;">${inputNewName}</span>`</span>);
<span/>  <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">return</span> resolve();
<span/><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 如果用户选的是“退出”选项</span>
<span/>} <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">else</span> {
<span/>  exit(<span class="hljs-number" style="color: #008080; line-height: 26px;">1</span>);
<span/>}
<span/></code></pre>
<ol data-tool="mdnice编辑器" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: decimal;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">如果用户选择了覆盖，我们就移除文件夹然后reolve</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">如果用户选择了创建新的文件夹，那么我们就再给出一个用于输入的终端，让用户输入新的文件夹名称。在用户输入完成后，我们把target的目标地址更新掉。</section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">如果用户选择退出，我们则调用process.exit方法进行退出当前node程序即可。</section></li></ol>
<h3 data-tool="mdnice编辑器" style="margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 20px; margin-top: 1.2em;"><span style="background-image: url(http://img.xiaogangzai.cn/title_h2.png); background-size: 100% 100%; background-repeat: no-repeat; display: inline-block; width: 16px; height: 15px; line-height: 15px; margin-bottom: -1px;"></span><span class="prefix" style="display: none;"></span><span class="content" style="font-size: 17px; font-weight: bold; display: inline-block; margin-left: 8px; color: #48b378;">❤️拉取git等远程仓库代码</span><span class="suffix" style="display: none;"></span></h3>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">在进行了文件夹监测完成之后，就应该是要下载我们在git上的项目资源了。下载资源我们是通过<a href="https://gitlab.com/flippidippi/download-git-repo#readme" style="word-wrap: break-word; font-weight: bold; color: #48b378; text-decoration: none; border-bottom: 1px solid #48b378;">download-git-repo</a>这个库来实现的。</p>
<ul data-tool="mdnice编辑器" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">安装</section></li></ul>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #f8f8f8; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #333; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #f8f8f8; border-radius: 5px;">cnpm install download-git-repo -S
<span/></code></pre>
<ul data-tool="mdnice编辑器" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">使用</section></li></ul>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #f8f8f8; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #333; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #f8f8f8; border-radius: 5px;"><span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">const</span> path = <span class="hljs-built_in" style="color: #0086b3; line-height: 26px;">require</span>(<span class="hljs-string" style="color: #d14; line-height: 26px;">'path'</span>);
<span/><span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">const</span> downloadRepo = <span class="hljs-built_in" style="color: #0086b3; line-height: 26px;">require</span>(<span class="hljs-string" style="color: #d14; line-height: 26px;">'download-git-repo'</span>);
<span/>
<span/>  <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 下载repo资源</span>
<span/>  downloadRepo() {
<span/>    <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 菊花转起来～</span>
<span/>    <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">this</span>.spinner.start(<span class="hljs-string" style="color: #d14; line-height: 26px;">'正在拉取项目模板...'</span>);
<span/>    <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">const</span> { repo, temp } = <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">this</span>.RepoMaps
<span/>    <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">return</span> <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">new</span> <span class="hljs-built_in" style="color: #0086b3; line-height: 26px;">Promise</span>(<span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">async</span> (resolve, reject) =&gt; {
<span/>      <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 如果本地临时文件夹存在，则先删除临时文件夹</span>
<span/>      <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">await</span> fs.removeSync(temp);
<span/>      <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">/**
<span/>       * 第一个参数为远程仓库地址，注意是类型:作者/库
<span/>       * 第二个参数为下载到的本地地址，
<span/>       * 后面还可以继续加一个配置参数对象，最后一个是回调函数，
<span/>       */</span>
<span/>      download(repo, temp, <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">async</span> err =&gt; {
<span/>        <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">if</span> (err) <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">return</span> reject(err);
<span/>        <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 菊花变成对勾</span>
<span/>        <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">this</span>.spinner.succeed(<span class="hljs-string" style="color: #d14; line-height: 26px;">'模版下载成功'</span>);
<span/>        <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">return</span> resolve()
<span/>      })
<span/>    })
<span/>  }
<span/></code></pre>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">主要逻辑就是把资源下载到我们当前的临时文件夹位置，如果临时文件夹已经存在了那么就先删除临时文件夹。</p>
<h3 data-tool="mdnice编辑器" style="margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 20px; margin-top: 1.2em;"><span style="background-image: url(http://img.xiaogangzai.cn/title_h2.png); background-size: 100% 100%; background-repeat: no-repeat; display: inline-block; width: 16px; height: 15px; line-height: 15px; margin-bottom: -1px;"></span><span class="prefix" style="display: none;"></span><span class="content" style="font-size: 17px; font-weight: bold; display: inline-block; margin-left: 8px; color: #48b378;">👍把资源拷贝到目标地址，并移除无关文件</span><span class="suffix" style="display: none;"></span></h3>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">上面通过git上资源的下载，我们是下载到了cli目录内的临时文件内，那么我们还需要把资源移动到我们指定的位置，并且删除不必要的资源。所以我们这边会在utlis里面封装一个公共函数，用于资源的拷贝:</p>
<ul data-tool="mdnice编辑器" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">拷贝函数的封装</section></li></ul>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #f8f8f8; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #333; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #f8f8f8; border-radius: 5px;"><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">/**
<span/> * copyFiles 拷贝下载的repo资源
<span/> * @param { string } tempPath 待拷贝的资源路径（绝对路径）
<span/> * @param { string } targetPath 资源放置路径（绝对路径）
<span/> * @param { Array&lt;string&gt; } excludes 需要排除的资源名称（会自动移除其所有子文件）
<span/> */</span>
<span/>exports.copyFiles = <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">async</span> (tempPath, targetPath, excludes = []) =&gt; {
<span/>  <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">const</span> removeFiles = [<span class="hljs-string" style="color: #d14; line-height: 26px;">'./git'</span>, <span class="hljs-string" style="color: #d14; line-height: 26px;">'./changelogs'</span>]
<span/>  <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 资源拷贝</span>
<span/>  <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">await</span> fs.copySync(tempPath, targetPath)
<span/>
<span/>  <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 删除额外的资源文件</span>
<span/>  <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">if</span> (excludes &amp;&amp; excludes.length) {
<span/>    <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">await</span> <span class="hljs-built_in" style="color: #0086b3; line-height: 26px;">Promise</span>.all(excludes.map(<span class="hljs-function" style="line-height: 26px;"><span class="hljs-params" style="line-height: 26px;">file</span> =&gt;</span> <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">async</span> () =&gt;
<span/>      <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">await</span> fs.removeSync(path.resolve(targetPath, file))
<span/>    ));
<span/>  }
<span/>}
<span/></code></pre>
<ul data-tool="mdnice编辑器" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;">调用</section></li></ul>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #f8f8f8; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #333; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #f8f8f8; border-radius: 5px;">// 拷贝repo资源
<span/>async <span class="hljs-function" style="line-height: 26px;"><span class="hljs-title" style="color: #900; font-weight: bold; line-height: 26px;">copyRepoFiles</span></span>() {
<span/>  const { temp, target } = this.RepoMaps
<span/>  await copyFiles(temp, target, [<span class="hljs-string" style="color: #d14; line-height: 26px;">'./git'</span>, <span class="hljs-string" style="color: #d14; line-height: 26px;">'./changelogs'</span>]);
<span/>}
<span/></code></pre>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">这里，我们移除了项目中本身含有的<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">./git</code>、<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">./changelogs</code>等文件，因为这些是该git项目需要的内容，而我们实际是不需要的。</p>
<h3 data-tool="mdnice编辑器" style="margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 20px; margin-top: 1.2em;"><span style="background-image: url(http://img.xiaogangzai.cn/title_h2.png); background-size: 100% 100%; background-repeat: no-repeat; display: inline-block; width: 16px; height: 15px; line-height: 15px; margin-bottom: -1px;"></span><span class="prefix" style="display: none;"></span><span class="content" style="font-size: 17px; font-weight: bold; display: inline-block; margin-left: 8px; color: #48b378;">👍自动更新package.json文件</span><span class="suffix" style="display: none;"></span></h3>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">通过上面的操作，我们已经把资源拷贝到我们的目标地址了。那么我们还想自动把package.json中的name、version、author等字段更新成我们需要的，应该怎么做呢？</p>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #f8f8f8; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #333; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #f8f8f8; border-radius: 5px;"><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">/**
<span/> * updatePkgFile
<span/> * @description 更新package.json文件
<span/> */</span>
<span/><span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">async</span> updatePkgFile() {
<span/>  <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 菊花转起来！</span>
<span/>  <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">this</span>.spinner.start(<span class="hljs-string" style="color: #d14; line-height: 26px;">'正在更新package.json...'</span>);
<span/>  <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 获取当前的项目内的package.json文件的据对路径</span>
<span/>  <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">const</span> pkgPath = path.resolve(<span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">this</span>.RepoMaps.target, <span class="hljs-string" style="color: #d14; line-height: 26px;">'package.json'</span>);
<span/>  <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 定义需要移除的字段</span>
<span/>  <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 这些字段本身只是git项目配置的内容，而我们业务项目是不需要的</span>
<span/>  <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">const</span> unnecessaryKey = [<span class="hljs-string" style="color: #d14; line-height: 26px;">'keywords'</span>, <span class="hljs-string" style="color: #d14; line-height: 26px;">'license'</span>, <span class="hljs-string" style="color: #d14; line-height: 26px;">'files'</span>]
<span/>  <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 调用方法获取用户的git信息</span>
<span/>  <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">const</span> { name = <span class="hljs-string" style="color: #d14; line-height: 26px;">''</span>, email = <span class="hljs-string" style="color: #d14; line-height: 26px;">''</span> } = <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">await</span> getGitUser();
<span/>
<span/>  <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 读取package.json文件内容</span>
<span/>  <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">const</span> jsonData = fs.readJsonSync(pkgPath);
<span/>  <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 移除不需要的字段</span>
<span/>  unnecessaryKey.forEach(<span class="hljs-function" style="line-height: 26px;"><span class="hljs-params" style="line-height: 26px;">key</span> =&gt;</span> <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">delete</span> jsonData[key]);
<span/>  <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 合并我们需要的信息</span>
<span/>  <span class="hljs-built_in" style="color: #0086b3; line-height: 26px;">Object</span>.assign(jsonData, {
<span/>    <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 以初始化的项目名称作为name</span>
<span/>    name: <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">this</span>.source,
<span/>    <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// author字段更新成我们git上的name</span>
<span/>    author: name &amp;&amp; email ? <span class="hljs-string" style="color: #d14; line-height: 26px;">`<span class="hljs-subst" style="color: #333; font-weight: normal; line-height: 26px;">${name}</span> <span class="hljs-subst" style="color: #333; font-weight: normal; line-height: 26px;">${email}</span>`</span> : <span class="hljs-string" style="color: #d14; line-height: 26px;">''</span>,
<span/>    <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 设置非私有</span>
<span/>    provide: <span class="hljs-literal" style="color: #008080; line-height: 26px;">true</span>,
<span/>    <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 默认设置版本号1.0.0</span>
<span/>    version: <span class="hljs-string" style="color: #d14; line-height: 26px;">"1.0.0"</span>
<span/>  });
<span/>  <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 将更新后的package.json数据写入到package.json文件中去</span>
<span/>  <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">await</span> fs.writeJsonSync(pkgPath, jsonData, { <span class="hljs-attr" style="line-height: 26px;">spaces</span>: <span class="hljs-string" style="color: #d14; line-height: 26px;">'\t'</span> });
<span/>  <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 停止菊花</span>
<span/>  <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">this</span>.spinner.succeed(<span class="hljs-string" style="color: #d14; line-height: 26px;">'package.json更新完成！'</span>);
<span/>}
<span/></code></pre>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">这一块，上面代码注释已经写的非常清晰了，看一遍应该就晓得过程逻辑了吧！！！至于其中获取用户git信息的逻辑，后面马上会讲解到！！！</p>
<h3 data-tool="mdnice编辑器" style="margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 20px; margin-top: 1.2em;"><span style="background-image: url(http://img.xiaogangzai.cn/title_h2.png); background-size: 100% 100%; background-repeat: no-repeat; display: inline-block; width: 16px; height: 15px; line-height: 15px; margin-bottom: -1px;"></span><span class="prefix" style="display: none;"></span><span class="content" style="font-size: 17px; font-weight: bold; display: inline-block; margin-left: 8px; color: #48b378;">🌟获取Git信息</span><span class="suffix" style="display: none;"></span></h3>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">现在我们看下如何获取git信息的，我们定义了一个公共的方法getGitUser：</p>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #f8f8f8; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #333; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #f8f8f8; border-radius: 5px;"><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">/**
<span/> * getGitUser
<span/> * @description 获取git用户信息
<span/> */</span>
<span/>exports.getGitUser = <span class="hljs-function" style="line-height: 26px;"><span class="hljs-params" style="line-height: 26px;">()</span> =&gt;</span> {
<span/>  <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">return</span> <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">new</span> <span class="hljs-built_in" style="color: #0086b3; line-height: 26px;">Promise</span>(<span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">async</span> (resolve) =&gt; {
<span/>    <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">const</span> user = {}
<span/>    <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">try</span> {
<span/>      <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">const</span> [name] = <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">await</span> runCmd(<span class="hljs-string" style="color: #d14; line-height: 26px;">'git config user.name'</span>)
<span/>      <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">const</span> [email] = <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">await</span> runCmd(<span class="hljs-string" style="color: #d14; line-height: 26px;">'git config user.email'</span>)
<span/>      <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 移除结尾的换行符</span>
<span/>      <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">if</span> (name) user.name = name.replace(<span class="hljs-regexp" style="color: #009926; line-height: 26px;">/\n/g</span>, <span class="hljs-string" style="color: #d14; line-height: 26px;">''</span>);
<span/>      <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">if</span> (email) user.email = <span class="hljs-string" style="color: #d14; line-height: 26px;">`&lt;<span class="hljs-subst" style="color: #333; font-weight: normal; line-height: 26px;">${email || <span class="hljs-string" style="color: #d14; line-height: 26px;">''</span>}</span>&gt;`</span>.replace(<span class="hljs-regexp" style="color: #009926; line-height: 26px;">/\n/g</span>, <span class="hljs-string" style="color: #d14; line-height: 26px;">''</span>)
<span/>    } <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">catch</span> (error) {
<span/>      log.error(<span class="hljs-string" style="color: #d14; line-height: 26px;">'获取用户Git信息失败'</span>)
<span/>      reject(error)
<span/>    } <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">finally</span> {
<span/>      resolve(user)
<span/>    }
<span/>  });
<span/>}
<span/></code></pre>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">我们都知道，在终端想查看用户的git信息，那么只需要键入<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">git config user.name</code>即可，<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">git config user.email</code>可以获取用户的邮箱。那么我们同样的在脚本中也执行这样的命令不就可以获取到了吗？</p>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">那么剩下的就是如何在终端执行shell命令呢？</p>
<h3 data-tool="mdnice编辑器" style="margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 20px; margin-top: 1.2em;"><span style="background-image: url(http://img.xiaogangzai.cn/title_h2.png); background-size: 100% 100%; background-repeat: no-repeat; display: inline-block; width: 16px; height: 15px; line-height: 15px; margin-bottom: -1px;"></span><span class="prefix" style="display: none;"></span><span class="content" style="font-size: 17px; font-weight: bold; display: inline-block; margin-left: 8px; color: #48b378;">✨✨node脚本中，执行指定的shell命令</span><span class="suffix" style="display: none;"></span></h3>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">node是通过开启一个子进程来执行脚本命令的，<a href="http://nodejs.cn/api/child_process.html#child_process_child_process_exec_command_options_callback" style="word-wrap: break-word; font-weight: bold; color: #48b378; text-decoration: none; border-bottom: 1px solid #48b378;">child_process说明</a>是node提供的一个开启子进程的方法。于是我们可以封装一个方法用于执行子进程：</p>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #f8f8f8; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #333; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #f8f8f8; border-radius: 5px;"><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// node的child_process可以开启一个进程执行任务</span>
<span/><span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">const</span> childProcess = <span class="hljs-built_in" style="color: #0086b3; line-height: 26px;">require</span>(<span class="hljs-string" style="color: #d14; line-height: 26px;">'child_process'</span>);
<span/>
<span/>
<span/><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">/**
<span/> * runCmd
<span/> * @description 运行cmd命令
<span/> * @param { string } 待运行的cmd命令
<span/> */</span> 
<span/><span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">const</span> runCmd = <span class="hljs-function" style="line-height: 26px;">(<span class="hljs-params" style="line-height: 26px;">cmd</span>) =&gt;</span> {
<span/>  <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">return</span> <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">new</span> <span class="hljs-built_in" style="color: #0086b3; line-height: 26px;">Promise</span>(<span class="hljs-function" style="line-height: 26px;">(<span class="hljs-params" style="line-height: 26px;">resolve, reject</span>) =&gt;</span> {
<span/>    childProcess.exec(cmd, (err, ...arg) =&gt; {
<span/>      <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">if</span> (err) <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">return</span> reject(err)
<span/>      <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">return</span> resolve(...arg)
<span/>    })
<span/>  })
<span/>}
<span/></code></pre>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">所以上述获取git详情的操作其实就是调用的这个方法，让node开启一个子进程去运行我们的git命令，然后将结果返回出来。</p>
<h3 data-tool="mdnice编辑器" style="margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 20px; margin-top: 1.2em;"><span style="background-image: url(http://img.xiaogangzai.cn/title_h2.png); background-size: 100% 100%; background-repeat: no-repeat; display: inline-block; width: 16px; height: 15px; line-height: 15px; margin-bottom: -1px;"></span><span class="prefix" style="display: none;"></span><span class="content" style="font-size: 17px; font-weight: bold; display: inline-block; margin-left: 8px; color: #48b378;">❤️初始化git文件</span><span class="suffix" style="display: none;"></span></h3>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #f8f8f8; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #333; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #f8f8f8; border-radius: 5px;"><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 初始化git文件</span>
<span/>  <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">async</span> initGit() {
<span/>    <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 菊花转起来</span>
<span/>    <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">this</span>.spinner.start(<span class="hljs-string" style="color: #d14; line-height: 26px;">'正在初始化Git管理项目...'</span>);
<span/>    <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 调用子进程，运行cd xxx的命令进入到我们目标文件目录</span>
<span/>    <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">await</span> runCmd(<span class="hljs-string" style="color: #d14; line-height: 26px;">`cd <span class="hljs-subst" style="color: #333; font-weight: normal; line-height: 26px;">${<span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">this</span>.RepoMaps.target}</span>`</span>);
<span/>    
<span/>    <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 调用process.chdir方法，把node进程的执行位置变更到目标目录</span>
<span/>    <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 这步很重要，不然会执行失败（因为执行位置不对）</span>
<span/>    process.chdir(<span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">this</span>.RepoMaps.target);
<span/>    
<span/>    <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 调用子进程执行git init命令，辅助我们进行git初始化</span>
<span/>    <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">await</span> runCmd(<span class="hljs-string" style="color: #d14; line-height: 26px;">`git init`</span>);
<span/>    <span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 菊花停下来</span>
<span/>    <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">this</span>.spinner.succeed(<span class="hljs-string" style="color: #d14; line-height: 26px;">'Git初始化完成！'</span>);
<span/>}
<span/></code></pre>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">这一块也是调用的我们封装的方法执行git命令而已。但是一定要注意、<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">process.chdir(this.RepoMaps.target);</code>变更进程的执行位置，如果变更目录失败会抛出异常（例如，如果指定的 directory 不存在）。这步操作非常重要，切记！！切记！！！详细可以查阅<a href="http://nodejs.cn/api/process.html#process_process_chdir_directory" style="word-wrap: break-word; font-weight: bold; color: #48b378; text-decoration: none; border-bottom: 1px solid #48b378;">process.chdir说明</a></p>
<h3 data-tool="mdnice编辑器" style="margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 20px; margin-top: 1.2em;"><span style="background-image: url(http://img.xiaogangzai.cn/title_h2.png); background-size: 100% 100%; background-repeat: no-repeat; display: inline-block; width: 16px; height: 15px; line-height: 15px; margin-bottom: -1px;"></span><span class="prefix" style="display: none;"></span><span class="content" style="font-size: 17px; font-weight: bold; display: inline-block; margin-left: 8px; color: #48b378;">🌟安装依赖</span><span class="suffix" style="display: none;"></span></h3>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">最后我们就需要自动暗转项目依赖了。本质也是调用子进程执行npm命令就可以了。这里我们直接指定了使用淘宝的镜像源，小伙伴们也可以扩展，根据用户的选择指定npm、yarn和其他镜像源等等，尽情发挥吧！！！</p>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #f8f8f8; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #333; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #f8f8f8; border-radius: 5px;"><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;">// 安装依赖</span>
<span/>  <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">async</span> runApp() {
<span/>    <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">try</span> {
<span/>      <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">this</span>.spinner.start(<span class="hljs-string" style="color: #d14; line-height: 26px;">'正在安装项目依赖文件，请稍后...'</span>);
<span/>      <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">await</span> runCmd(<span class="hljs-string" style="color: #d14; line-height: 26px;">`npm install --registry=https://registry.npm.taobao.org`</span>);
<span/>      <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">await</span> runCmd(<span class="hljs-string" style="color: #d14; line-height: 26px;">`git add . &amp;&amp; git commit -m"init: 初始化项目基本框架"`</span>);
<span/>      <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">this</span>.spinner.succeed(<span class="hljs-string" style="color: #d14; line-height: 26px;">'依赖安装完成！'</span>);
<span/>
<span/>      <span class="hljs-built_in" style="color: #0086b3; line-height: 26px;">console</span>.log(<span class="hljs-string" style="color: #d14; line-height: 26px;">'请运行如下命令启动项目吧：\n'</span>);
<span/>      log.success(<span class="hljs-string" style="color: #d14; line-height: 26px;">`   cd <span class="hljs-subst" style="color: #333; font-weight: normal; line-height: 26px;">${<span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">this</span>.source}</span>`</span>);
<span/>      log.success(<span class="hljs-string" style="color: #d14; line-height: 26px;">`   npm run serve`</span>);
<span/>    } <span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">catch</span> (error) {
<span/>      <span class="hljs-built_in" style="color: #0086b3; line-height: 26px;">console</span>.log(<span class="hljs-string" style="color: #d14; line-height: 26px;">'项目安装失败，请运行如下命令手动安装：\n'</span>);
<span/>      log.success(<span class="hljs-string" style="color: #d14; line-height: 26px;">`   cd <span class="hljs-subst" style="color: #333; font-weight: normal; line-height: 26px;">${<span class="hljs-keyword" style="color: #333; font-weight: bold; line-height: 26px;">this</span>.source}</span>`</span>);
<span/>      log.success(<span class="hljs-string" style="color: #d14; line-height: 26px;">`   npm run install`</span>);
<span/>    }
<span/>  }
<span/></code></pre>
<h3 data-tool="mdnice编辑器" style="margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 20px; margin-top: 1.2em;"><span style="background-image: url(http://img.xiaogangzai.cn/title_h2.png); background-size: 100% 100%; background-repeat: no-repeat; display: inline-block; width: 16px; height: 15px; line-height: 15px; margin-bottom: -1px;"></span><span class="prefix" style="display: none;"></span><span class="content" style="font-size: 17px; font-weight: bold; display: inline-block; margin-left: 8px; color: #48b378;">最后👍👍👍</span><span class="suffix" style="display: none;"></span></h3>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;"><a href="https://github.com/chinaBerg/vta-cli" style="word-wrap: break-word; font-weight: bold; color: #48b378; text-decoration: none; border-bottom: 1px solid #48b378;">vta-cli脚手架git源码地址</a>，有兴趣的小伙伴可以查阅代码实现。也可以使用vta-cli快速初始化<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">Vue+Ts+ElementUi</code>的RBAC后台管理系统的基础架构。安装<code style="font-size: 14px; word-wrap: break-word; padding: 2px 4px; border-radius: 4px; margin: 0 2px; background-color: rgba(27,31,35,.05); font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; word-break: break-all; color: #28ca71;">vta-cli</code>的方法:</p>
<pre class="custom" data-tool="mdnice编辑器" style="margin-top: 10px; margin-bottom: 10px; border-radius: 5px; box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;"><span style="display: block; background: url(https://imgkr.cn-bj.ufileos.com/97e4eed2-a992-4976-acf0-ccb6fb34d308.png); height: 30px; width: 100%; background-size: 40px; background-repeat: no-repeat; background-color: #f8f8f8; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px;"></span><code class="hljs" style="overflow-x: auto; padding: 16px; color: #333; display: block; font-family: Operator Mono, Consolas, Monaco, Menlo, monospace; font-size: 12px; -webkit-overflow-scrolling: touch; padding-top: 15px; background: #f8f8f8; border-radius: 5px;"><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;"># 安装cli</span>
<span/>npm i vta-cli -g
<span/>
<span/><span class="hljs-comment" style="color: #998; font-style: italic; line-height: 26px;"># 初始化项目</span>
<span/>vta create my-app
<span/></code></pre>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;"><a href="https://github.com/chinaBerg/vue-typescript-admin" style="word-wrap: break-word; font-weight: bold; color: #48b378; text-decoration: none; border-bottom: 1px solid #48b378;">vue-typescript-admin</a>项目模板将会很快完善起来！！！也欢迎小伙伴们一起贡献代码哦～～</p>
<figure data-tool="mdnice编辑器" style="margin: 0; margin-top: 10px; margin-bottom: 10px; display: flex; flex-direction: column; justify-content: center; align-items: center;"><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/7/10/17337a30a851e21c~tplv-t2oaga2asx-image.image" alt style="display: block; margin: 0 auto; max-width: 100%; border-radius: 4px; margin-bottom: 25px;"></figure>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">关于cli开发的讲解，到这就基本结束了！！！上面涵盖了常见的技术实现方案和注意细节，项目可以无痛上手的～～～有兴趣的小伙伴们可以照着封装自己的cli，把业务通用的场景解决方案抽离处理，提升自己的开发效率吧！最后，我是你们的老朋友愣锤，欢迎👏👏点赞👍👍收藏💗💗哦～～～</p>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">点赞👍、收藏👋、分享防走丢哦！！！需要的时候可以拿出来对着开发～～～</p>
<h3 data-tool="mdnice编辑器" style="margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 20px; margin-top: 1.2em;"><span style="background-image: url(http://img.xiaogangzai.cn/title_h2.png); background-size: 100% 100%; background-repeat: no-repeat; display: inline-block; width: 16px; height: 15px; line-height: 15px; margin-bottom: -1px;"></span><span class="prefix" style="display: none;"></span><span class="content" style="font-size: 17px; font-weight: bold; display: inline-block; margin-left: 8px; color: #48b378;">❤️❤️❤️更新留白</span><span class="suffix" style="display: none;"></span></h3>
<p data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em;">此处将留作后续更多和脚手架开发相关的优秀库的展示地址，后续会继续更新～～～</p>
<h3 data-tool="mdnice编辑器" style="margin-bottom: 15px; padding: 0px; font-weight: bold; color: black; font-size: 20px; margin-top: 1.2em;"><span style="background-image: url(http://img.xiaogangzai.cn/title_h2.png); background-size: 100% 100%; background-repeat: no-repeat; display: inline-block; width: 16px; height: 15px; line-height: 15px; margin-bottom: -1px;"></span><span class="prefix" style="display: none;"></span><span class="content" style="font-size: 17px; font-weight: bold; display: inline-block; margin-left: 8px; color: #48b378;">👍👍👍作者其他文章推荐</span><span class="suffix" style="display: none;"></span></h3>
<ul data-tool="mdnice编辑器" style="margin-top: 8px; margin-bottom: 8px; padding-left: 25px; color: black; list-style-type: disc;">
<li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;"><a href="https://juejin.im/post/6844904192331481101" style="word-wrap: break-word; font-weight: bold; color: #48b378; text-decoration: none; border-bottom: 1px solid #48b378;">图文详解vue+ts+class+注解风格开发排坑全指南</a></section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;"><a href="https://juejin.im/post/6844904186925023239" style="word-wrap: break-word; font-weight: bold; color: #48b378; text-decoration: none; border-bottom: 1px solid #48b378;">5分钟上手Egg.js+Nunjucks模板引擎快速开发SEO友好的项目</a></section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;"><a href="https://juejin.im/post/6844903901586522120" style="word-wrap: break-word; font-weight: bold; color: #48b378; text-decoration: none; border-bottom: 1px solid #48b378;">中高级前端进阶之极速通关koa2全栈核心内容（图文并茂）</a></section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;"><a href="https://juejin.im/post/6844903679162581005" style="word-wrap: break-word; font-weight: bold; color: #48b378; text-decoration: none; border-bottom: 1px solid #48b378;">vue插件开发、文档书写、github发布、npm包发布一波流</a></section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;"><a href="https://juejin.im/post/6844903862051029006" style="word-wrap: break-word; font-weight: bold; color: #48b378; text-decoration: none; border-bottom: 1px solid #48b378;">嗯，真香！精简ES函数式编程核心概念</a></section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;"><a href="https://juejin.im/post/6844903652881072141" style="word-wrap: break-word; font-weight: bold; color: #48b378; text-decoration: none; border-bottom: 1px solid #48b378;">vue中Axios的封装和API接口的管理</a></section></li><li><section style="margin-top: 5px; margin-bottom: 5px; line-height: 26px; text-align: left; color: rgb(1,1,1); font-weight: 500;"><a href="https://juejin.im/post/6844903632815521799" style="word-wrap: break-word; font-weight: bold; color: #48b378; text-decoration: none; border-bottom: 1px solid #48b378;">Vue 项目里戳中你痛点的问题及解决办法</a></section></li></ul>
<p id="nice-suffix-juejin-container" class="nice-suffix-juejin-container" data-tool="mdnice编辑器" style="font-size: 16px; padding-bottom: 8px; margin: 0; padding-top: 1em; color: rgb(74,74,74); line-height: 1.75em; margin-top: 20px !important;">本文使用 <a href="https://mdnice.com/?from=juejin" style="word-wrap: break-word; font-weight: bold; color: #48b378; text-decoration: none; border-bottom: 1px solid #48b378;">mdnice</a> 排版</p></section>